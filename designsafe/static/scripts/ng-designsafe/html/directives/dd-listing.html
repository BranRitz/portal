<div class="table-responsive" ng-class="{'preview-wrapper': browser.showPreviewListing}">
  <div class="ds-table-display-wrapper" ds-infinite-scroll
        data-scroll-bottom="scrollToBottom()()"
        data-scroll-top="scrollToTop()()"
        data-bottom-height="0"
        ng-if="browser.showMainListing">
    <table class="table table-bordered table-striped" style="background-color: #fff;">
        <thead>
        <th>Name</th>
        <th>Size</th>
        <th>Last modified</th>
        <!--
        <th>Details</th>
        -->
        </thead>

        <tbody>
        <tr ng-if="!browser.busyListing"
            ng-repeat="item in browser.listing.children"
            ng-click="onSelect()($event, item)"
            ng-class="{'ds-data-selected': item._ui.selected}"
        >
            <td>
                <i class="fa {{ item.icon() }}"></i>
                <a ng-href="{{ item.href }}" ng-click="onBrowse()($event, item)">
                    {{ item.name }}
                </a>

                <span class="tag-item"
                      ng-repeat="entityTag in item._entityTags">
                  {{entityTag}}
                </span>
            <div style="width:100%;">
            <span ng-if="browser.loadingEntities">
            Loading <i class="fa fa-spinner fa-spin"></i>
            </span>
            <span class="label selected"
              ng-repeat-start="entity in item._entities"
              ng-class="{'tag-blue': entity.name === 'designsafe.project.model_config', 'tag-green': entity.name === 'designsafe.project.sensor_list', 'tag-red': entity.name === 'designsafe.project.event', 'tag-light-blue': entity.name === 'designsafe.project.analysis'}">{{ entity._displayName }}</span> 
            <span ng-repeat-end class="tag-title">{{entity.value.title}}</span>
            </div>
            </td>
            <td>{{ item.length|bytes }}</td>
            <td>{{ item.lastModified|date:"short" }}</td>
            <!--
            <td>
                <a class="btn btn-info btn-xs" ng-click="onDetail()($event, item)">
                    <i class="fa fa-info-circle"></i><span style="display:block;">Details</span>
                </a>
            </td>
            -->
        </tr>
        <tr ng-if="browser.busyListingPage">
          <td>
                <span class="bg-info text-info">
                    <i class="fa fa-spinner fa-spin"></i> Loading...
                </span>
          </td>
        </tr>
        </tbody>
        <caption style="padding:0px;">

            <div ng-if="browser.busy"
                 style="padding:10px; font-size:large; with:100%;"
                 class="bg-info">
                <span>
                    <i class="fa fa-spinner fa-spin"></i> Loading...
                </span>
            </div>

            <div ng-if="! browser.busy && browser.error" class="text-center">
                <p class="alert alert-danger">
                    {{ browser.error.message || browser.error }}
                </p>
            </div>

            <div ng-if="! browser.busy && ! browser.error && (browser.listing.children|length) === 0" style="background-color: #fff;border: 1px solid #ddd;padding:8px;" class="text-center">
                <p class="lead">
                    This folder is empty!
                    <br><i class="fa fa-folder-open-o"></i>
                </p>
            </div>
        </caption>
    </table>
  </div>

<div>
  <div
        ng-repeat="experiment in publicationCtrl().filterExperiments(browser.project.experiment_set)"
         ng-if="browser.showPreviewListing &&
                (!browser.publishPipeline ||
                browser.publishPipeline != 'meta')"
         style="background:#fff;">
    <div style="border:1px solid black; background:white;">
      <div style="width:50%; display:inline-block;">
      <h3>{{experiment.value.title}}</h3>
      <p>{{experiment.value.descrpition}}</p>
      </div>
      <div style="width:49%; vertical-align:top; display:inline-block;">
        <div style="border:1px solid black;">
          {{experiment.getEF(browser.project.value.projectType, experiment.value.experimentalFacility).label}}
        </div>
        <div style="border:1px solid black;">
          {{experiment.getET(experiment.value.experimentalFacility, experiment.value.experimentType).label}}
        </div>
      </div>
    </div>
    <div ng-repeat="event in publicationCtrl().filterEvents(browser.project.getRelated('event_set', experiment.uuid))">
    <div style="padding:3px;">
      <span class="ds-text-red folder-tick">Event Data </span>
      <span style="color:light-gray">Link to: </span>
      <a class="ds-text-blue" href="#details-{{browser.project.getRelatedByUuid(event.value.modelConfigs[0]).uuid}}"
      data-toggle="collapse" data-target="#files-{{browser.project.getRelatedByUuid(event.value.modelConfigs[0]).uuid}}">
      Model Configuration
      </a>
      <a class="ds-text-green" href="#details-{{browser.project.getRelatedByUuid(event.value.sensorLists[0]).uuid}}"
         data-toggle="collapse" data-target="#files-{{browser.project.getRelatedByUuid(event.value.sensorLists[0]).uuid}}">
      Sensor List
      </a>
    </div>
    <div style="position:absolute; left:-100px; margin-top:-20px; width:110px;">
      <div style="border-bottom:1px solid lightgrey;">
      <a class="ds-text-red" ng-click="openPreviewTree()($event, event.uuid)" href="#">{{event.value.title}}</a>
      </div>
      <div>
      <a class="ds-text-blue" href="" ng-click="openPreviewTree()($event, event.value.modelConfigs[0])">
        {{browser.project.getRelatedByUuid(event.value.modelConfigs[0]).value.title}}
      </a>
      </div>
      <div>
      <a class="ds-text-green" href="" ng-click="openPreviewTree()($event, event.value.sensorLists[0])">
        {{browser.project.getRelatedByUuid(event.value.sensorLists[0]).value.title}}
      </a>
      </div>
    </div>
    <div style="margin-left:-5px; padding-left:5px; margin-top:-11px; padding-top:7px; border-left:1px solid #ccc; border-radius:5px 0px 0px 5px;">
    <table  class="table table-bordered table-striped"
            style="background-color: #fff;">
        <thead>
        <th>Name</th>
        <th>Size</th>
        <th>Last modified</th>
        <th ng-if="browser.publishPipeline">
          <button class="btn btn-default"
                  ng-if="! (browser.publication[experiment.uuid][event.uuid] && browser.publication[experiment.uuid][event.uuid].length)"
                  ng-click="publicationCtrl().selectAllFiles(experiment, event)">
                  <i class="fa fa-check"></i> Select All
                  </button>
          <button class="btn btn-default"
                  ng-if="browser.publication[experiment.uuid][event.uuid] && browser.publication[experiment.uuid][event.uuid].length"
                  ng-click="publicationCtrl().deselectAllFiles(experiment, event)">
                  <i class="fa fa-times"></i> Deselect All</button>
        </th>
        </thead>
        <tbody>
          <tr ng-repeat="file in publicationCtrl().filterFiles(experiment, event, browser.listings[event.uuid])">
            <td><i class="fa {{file.icon()}}"></i>
                <a ng-href="{{file.href}}" ng-click="onBrowse()($event, file)">
                {{file.name}}
                </a>
            </td>
            <td>{{file.length|bytes}}</td>
            <td>{{file.lastModified|date:"short"}}</td>
            <td ng-if="browser.publishPipeline">
                <button class="btn btn-success"
                        ng-if="publicationCtrl().isFileSelectedForPublication(experiment, event, file)"
                        ng-click="publicationCtrl().deselectFileForPublication(experiment, event, file)"
                        title="Selected">
                  <i class="fa fa-check"></i><span class="sr-only">Selected</span>
                </button>
                <button class="btn btn-danger"
                        ng-if="!publicationCtrl().isFileSelectedForPublication(experiment, event, file)"
                        ng-click="publicationCtrl().selectFileForPublication(experiment, event, file)"
                        title="Not Selected">
                  <i class="fa fa-times"></i><span class="sr-only">Not Selected</span>
                </button>
            </td>
          </tr>
        </tbody>
    </table>
    </div>
    </div>
    </div>

</div>
    <div class="project-preview-entities-details"
         ng-if="browser.showPreviewListing &&
               (!browser.publishPipeline || 
                browser.publishPipeline === 'select')">

      <div ng-repeat="modelConfig in browser.project.modelconfiguration_set">
        <div class="dropdown" id="details-{{modelConfig.uuid}}">
          <button class="btn btn-sm btn-default collapsed ds-text-blue" data-toggle="collapse" data-target="#files-{{modelConfig.uuid}}"
                  style="width:100%;">
            Model Config {{modelConfig.value.title}}
          </button>
          <div id="files-{{modelConfig.uuid}}" class="collapse">
            <table  class="table table-bordered table-striped"
                    style="background-color: #fff;">
                <thead>
                <th>Name</th>
                <th>Size</th>
                <th>Last modified</th>
                </thead>
                <tbody>
                  <tr ng-repeat="file in browser.listings[modelConfig.uuid]">
                    <td><i class="fa {{file.icon()}}"></i>
                        <a ng-href="{{file.href}}" ng-click="onBrowse()($event, file)">
                        {{file.name}}
                        </a>
                    </td>
                    <td>{{file.length}}</td>
                    <td>{{file.lastModified|date:"short"}}</td>
                  </tr>
                </tbody>
            </table>
          </div>
        </div>
      </div>

      <div ng-repeat="sensorList in browser.project.sensorlist_set">
        <div class="dropdown" id="details-{{sensorList.uuid}}">
          <button class="btn btn-sm btn-default collapsed ds-text-green" data-toggle="collapse" data-target="#files-{{sensorList.uuid}}"
                  style="width:100%;">
            Sensor List {{sensorList.value.title}}
          </button>
          <div id="files-{{sensorList.uuid}}" class="collapse">
            <table  class="table table-bordered table-striped"
                    style="background-color: #fff;">
                <thead>
                <th>Name</th>
                <th>Size</th>
                <th>Last modified</th>
                </thead>
                <tbody>
                  <tr ng-repeat="file in browser.listings[sensorList.uuid]">
                    <td><i class="fa {{file.icon()}}"></i>
                        <a ng-href="{{file.href}}" ng-click="onBrowse()($event, file)">
                        {{file.name}}
                        </a>
                    </td>
                    <td>{{file.length}}</td>
                    <td>{{file.lastModified|date:"short"}}</td>
                  </tr>
                </tbody>
            </table>
          </div>
        </div>
      </div>

      <div ng-repeat="analysis in browser.project.analysis_set">
        <div class="dropdown" id="details-{{analysis.uuid}}">
          <button class="btn btn-default btn-sm collapsed ds-text-light-blue" data-toggle="collapse" data-target="#files-{{analysis.uuid}}"
                  style="width:100%;">
            Analysis {{analysis.value.title}}
          </button>
          <div id="files-{{analysis.uuid}}" class="collapse">
            <table  class="table table-bordered table-striped"
                    style="background-color: #fff;">
                <thead>
                <th>Name</th>
                <th>Size</th>
                <th>Last modified</th>
                </thead>
                <tbody>
                  <tr ng-repeat="file in browser.listings[analysis.uuid]">
                    <td><i class="fa {{file.icon()}}"></i>
                        <a ng-href="{{file.href}}" ng-click="onBrowse()($event, file)">
                        {{file.name}}
                        </a>
                    </td>
                    <td>{{file.length}}</td>
                    <td>{{file.lastModified|date:"short"}}</td>
                  </tr>
                </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>

    <div class="meta-review"
        ng-if="browser.publishPipeline === 'meta'">
      <div class="title">
        Project Information
        <span class="pull-right"><a href="/help">Need Help?</a></span>
      </div>  
      <div class="content">
       <div class="content-wrapper">
       <h3>Project Information</h3>
        <div class="meta-row">
          <span class="attr pull-left">Date of Publication</span>
          <span class="value pull-right">{{browser.project.dateOfPublication()}}</span>
          </div>
        <div class="meta-row">
          <span class="attr pull-left">Project Title </span><span>(required)</span>
          <span class="value pull-right">{{browser.project.value.title}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Project Type </span><span>(required)</span>
          <span class="value pull-right">{{browser.project.value.projectType}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Participant Instiutions </span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="inst in browser.project.participantInstitutions(browser.publication.experimentsList)">
                {{inst.label}}
                </span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Team Members </span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="username in browser.project.value.teamMembers">
                <ds-user username="username" format="name"></ds-user>
                </span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Project Description </span><span>(required)</span>
          <span class="value pull-right">{{browser.project.value.descrpition}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Funding Agency & Award Number</span><span> (recommended)</span>
          <span class="value pull-right">{{browser.project.value.awardNumber}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Associated Projects</span><span> (recommended)</span>
          <span class="value pull-right"
                ng-repeat="asoc in browser.project.value.associatedProjects">
                {{asoc}}
                </span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Rights </span><span>(required)</span>
          <span class="value pull-right">Licence #1</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Subject </span><span>(required)</span>
          <span class="value pull-right"></span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Publisher </span><span>(required)</span>
          <span class="value pull-right">Designsafe-CI</span>
        </div>
        <div class="meta-row">
        </div>
      </div>
     <div class="content-wrapper"
          ng-repeat="exp in browser.publication.experimentsList">
          <h3>Experiment Information</h3>

        <div class="meta-row">
          <span class="attr pull-left">Date of Publication</span>
          <span class="value pull-right">{{browser.project.dateOfPublication()}}</span>
          </div>
        <div class="meta-row">
          <span class="attr pull-left">Experiment Title</span><span>(required)</span>
          <span class="value pull-right">{{exp.value.title}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Experiment Type</span><span>(required)</span>
          <span class="value pull-right">{{exp.getET(exp.value.experimentalFacility, exp.value.experimentType).label}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Experiment Facility</span><span>(required)</span>
          <span class="value pull-right">{{exp.getEF(browser.project.value.projectType, exp.value.experimentalFacility).label}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Authors</span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="username in browser.project.value.teamMembers">
                <ds-user username="username" format="name"></ds-user>
                </span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Model Configurations</span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="model_config in browser.project.getRelated('modelconfiguration_set', exp.uuid)">
                {{model_config.value.title}}
                </span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Sensor Information</span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="sensor_list in browser.project.getRelated('sensorlist_set', exp.uuid)">
                {{sensor_list.value.title}}
                </span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Events</span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="event in browser.project.getRelated('event_set', exp.uuid)">
                {{event.value.title}}
                </span>
        </div>
     </div>
     <div class="content-wrapper"
          ng-repeat="analysis in browser.project.analysis_set">
          <h3>Analysis Information</h3>
        <div class="meta-row">
          <span class="attr pull-left">Date of Publication</span>
          <span class="value pull-right">{{browser.project.dateOfPublication()}}</span>
        <div class="meta-row">
          <span class="attr pull-left">Analysis Title</span><span>(required)</span>
          <span class="value pull-right">{{analysis.value.title}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Description</span><span>(required)</span>
          <span class="value pull-right">{{analysis.value.description}}</span>
        </div>
        <div class="meta-row">
          <span class="attr pull-left">Referenced Data</span><span>(required)</span>
          <span class="value pull-right"
                ng-repeat="event in browser.project.getRelated('event_set', analysis.uuid)">
                [Event] {{event.value.title}}
          </span>
        </div>
     </div>
    </div>

</div>
