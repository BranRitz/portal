{"version":3,"sources":["webpack:///webpack/bootstrap dc974ce78023e74fba52","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-data-service.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js"],"names":["DBModalCtrl","$scope","$uibModalInstance","selected","dismiss","label","fg","feature_group","show","show_contents","getLayers","name","layer_groups","description","out","tmp","lg","json","feature","toGeoJSON","image_src","properties","get_file_extension","fname","split","pop","mod","controller","angular","module","service","$timeout","$window","$uibModal","DataService","$http","GeoDataService","primary_color","open_db_modal","streets","L","tileLayer","maxZoom","satellite","map","layers","control","basemaps","zoomControl","setPosition","invalidateSize","project","active_layer_group","on","e","object","options","color","secondary_color","fillColor","fillOpacity","addLayer","$apply","dc","Control","position","draw","circle","edit","featureGroup","remove","push","select_active_layer_group","removeLayer","splice","i","removeControl","drawControl","add_draw_controls","active","modal","result","then","f","$","click","Polygon","latLngs","getLatLng","markerBounds","latLngBounds","fitBounds","getBounds","src_lg","console","log","loading","features","forEach","lf","retval","current_layer","setStyle","restrict","scope","handler","link","element","ev","GeoUtils","$q","image_icon","iconSize","html","className","max_width","max_height","base64","_arrayBufferToBase64","blob","ctx","canvas","getContext","canvasCopy","document","createElement","copyContext","img","Image","ratio","width","drawImage","toDataURL","bytes","Uint8Array","len","byteLength","binary","String","fromCharCode","encoded","btoa","l","omnivore","kml","parse","text_blob","d","res","rej","zipper","key","zip","files","ext","async","txt","geoJSON","gpx","thumb","marker","lat","lon","exif","EXIF","GPSLatitude","GPSLongitude","latRef","GPSLatitudeRef","_resize_image","file","preview","_make_image_marker","JSON","group","feat","reader","readAsArrayBuffer","readAsText","onload","p","_from_json","target","_from_kmz","_from_gpx","_from_image","_from_dsmap","responseType","get","agaveUrl","resp","data","Blob","url","URL","createObjectURL","a","download","textContent","base_file_url","form","FormData","File","append","post","headers","$state","GeoStateService","templateUrl","resolve","auth","state","$uibTooltipProvider","config"],"mappings":"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","file":"./designsafe/apps/geo/static/designsafe/apps/geo/scripts/build/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap dc974ce78023e74fba52","export default class DBModalCtrl {\n\n  constructor ($scope, $uibModalInstance) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.selected = null;\n  }\n\n  ok () {\n    this.$uibModalInstance.close(this.selected);\n  };\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","export default class LayerGroup {\n\n  constructor (label, fg) {\n    this.label = label;\n    this.feature_group = fg;\n    this.show = true;\n    this.show_contents = true;\n  }\n\n  num_features () {\n    return this.feature_group.getLayers().length;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","\nexport default class MapProject {\n\n  constructor (name) {\n    this.name = name;\n    this.layer_groups = [];\n    this.description = null;\n  }\n\n  to_json() {\n    let out = {\n      \"type\": \"FeatureCollection\",\n      \"features\": [],\n      \"ds_map\": true,\n      \"name\": this.name\n    };\n    this.layer_groups.forEach( (lg) => {\n      let tmp = {\n        \"type\": \"FeatureCollection\",\n        \"features\": [],\n        \"label\": lg.label\n      };\n      lg.feature_group.getLayers().forEach( (feature) => {\n        let json = feature.toGeoJSON();\n        //add in any options\n        if (feature.image_src) {\n          json.properties.image_src = feature.image_src;\n        }\n        tmp.features.push(json);\n      });\n      out.features.push(tmp);\n    });\n    return out;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","export function get_file_extension (fname) {\n  return fname.split('.').pop();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","import MapSidebarCtrl from './map-sidebar';\nimport DBModalCtrl from './db-modal';\nlet mod = angular.module('ds.geo.controllers', []);\n\nmod.controller('MapSidebarCtrl', MapSidebarCtrl);\nmod.controller('DBModalCtrl', DBModalCtrl);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","import customOnChange from './custom-on-change';\n\nlet mod = angular.module('ds.geo.directives', []);\n\n\nmod.directive('customOnChange', customOnChange);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","// import customOnChange from './custom-on-change';\nimport GeoStateService from './geo-state-service';\nimport GeoDataService from './geo-data-service';\n\nlet mod = angular.module('ds.geo.services', []);\nmod.service('GeoStateService', GeoStateService);\nmod.service('GeoDataService', GeoDataService);\n\n// mod.directive('customOnChange', customOnChange);\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","import LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\nimport DBModalCtrl from './db-modal';\nimport * as GeoUtils from '../utils/geo-utils';\n\nexport default class MapSidebarCtrl {\n\n  constructor ($scope, $window, $timeout, $uibModal, DataService, $http, GeoDataService) {\n    'ngInject';\n    this.$scope = $scope;\n    this.LGeo = $window.LGeo;\n    this.$timeout = $timeout;\n    this.$window = $window;\n    this.$uibModal = $uibModal;\n    this.DataService = DataService;\n    this.$http = $http;\n    this.GeoDataService = GeoDataService;\n\n    this.primary_color = '#ff0000';\n    this.secondary_color = '#ff0000';\n\n    //method binding for callback, sigh...\n    this.local_file_selected = this.local_file_selected.bind(this);\n    this.open_db_modal = this.open_db_modal.bind(this);\n\n    let streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n    });\n\n    let satellite = L.tileLayer(\n      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\n      attribution: '&copy;',\n      maxZoom: 18,\n    });\n\n    let basemaps = {\n      'Street': streets,\n      'Satellite': satellite\n    };\n\n    this.project = new MapProject('New Map');\n    console.log(this.project)\n    this.map = L.map('geo_map', {layers: [streets, satellite], measureControl:true}).setView([0, 0], 3);\n    L.control.layers(basemaps).addTo(this.map);\n    this.map.zoomControl.setPosition('bottomleft');\n\n    // trick to fix the tiles that sometimes don't load for some reason...\n    $timeout( () => {this.map.invalidateSize();}, 10);\n\n    this.project.layer_groups = [new LayerGroup('New Group', new L.FeatureGroup())];\n    this.map.addLayer(this.project.layer_groups[0].feature_group);\n    this.active_layer_group = this.project.layer_groups[0];\n\n    // update the current layer to show the details tab\n    this.active_layer_group.feature_group.on('click', (e) => {\n      // this.current_layer ? this.current_layer = null : this.current_layer = e.layer;\n      // this.$scope.$apply();\n    });\n\n    this.add_draw_controls(this.active_layer_group.feature_group);\n\n    this.map.on('draw:created',  (e) => {\n      let object = e.layer;\n      object.options.color = this.secondary_color;\n      object.options.fillColor = this.primary_color;\n      object.options.fillOpacity = 0.8;\n      this.active_layer_group.feature_group.addLayer(object);\n      this.$scope.$apply();\n    });\n\n    this.map.on('mousemove', (e) => {\n      this.current_mouse_coordinates = e.latlng;\n      this.$scope.$apply();\n    });\n\n\n  } // end constructor\n\n  add_draw_controls (fg) {\n    let dc = new L.Control.Draw({\n      position: 'topright',\n      draw: {\n        circle: false,\n      },\n      edit: {\n       featureGroup: fg,\n       remove: true\n      }\n    });\n    this.map.addControl(dc);\n    this.drawControl = dc;\n  }\n\n\n  create_layer_group () {\n    let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n    this.project.layer_groups.push(lg);\n    this.active_layer_group = this.project.layer_groups[this.project.layer_groups.length -1];\n    this.map.addLayer(lg.feature_group);\n    this.select_active_layer_group(this.active_layer_group);\n  }\n\n  delete_layer_group (lg, i) {\n    this.map.removeLayer(lg.feature_group);\n    this.project.layer_groups.splice(i, 1);\n  }\n\n  delete_feature (f) {\n    this.map.removeLayer(f);\n    this.active_layer_group.feature_group.removeLayer(f);\n  }\n\n  show_hide_layer_group (lg) {\n    lg.show ? this.map.addLayer(lg.feature_group) : this.map.removeLayer(lg.feature_group);\n  }\n\n  select_active_layer_group(lg) {\n    this.map.removeControl(this.drawControl);\n    this.add_draw_controls(lg.feature_group);\n    this.active_layer_group = lg;\n    lg.active = true;\n    lg.show = true;\n  }\n\n  open_db_modal () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/db-modal.html\",\n      controller: \"DBModalCtrl as vm\",\n    });\n    modal.result.then( (f) => {this.load_from_data_depot(f);});\n  }\n\n  open_file_dialog () {\n    this.$timeout(() => {\n      $('#file_picker').click();\n    }, 0);\n  }\n\n  get_feature_type (f) {\n    if (f.image_src) {\n      return 'Image';\n    } else if (f instanceof L.Marker) {\n      return 'Point';\n    } else if (f instanceof L.Polygon) {\n      return 'Polygon';\n    } else {\n      return 'Path';\n    }\n  }\n\n  zoom_to(feature) {\n    if (feature instanceof L.Marker) {\n       let latLngs = [ feature.getLatLng() ];\n       let markerBounds = L.latLngBounds(latLngs);\n       this.map.fitBounds(markerBounds);\n    } else {\n      this.map.fitBounds(feature.getBounds());\n    };\n  }\n\n  on_drop (ev, data, lg) {\n    let src_lg = this.project.layer_groups[data.pidx];\n    let feature = src_lg.feature_group.getLayers()[data.idx];\n    src_lg.feature_group.removeLayer(feature);\n    lg.feature_group.addLayer(feature);\n  }\n\n  drop_feature_success (ev, data, lg) {\n    console.log(\"drag_feature_success\", ev, data, lg);\n  }\n\n  load_from_data_depot(f) {\n    this.loading = true;\n    this.GeoDataService.load_from_data_depot(f).then( (features) => {\n      features.forEach( (f) => {\n        this.active_layer_group.feature_group.addLayer(f);\n      });\n      this.map.fitBounds(this.active_layer_group.feature_group.getBounds());\n      this.loading = false;\n    });\n  }\n\n  local_file_selected (ev) {\n    this.loading = true;\n    let file = ev.target.files[0];\n    let lf = this.GeoDataService.load_from_local_file(file).then( (retval) => {\n      if (retval instanceof MapProject) {\n        console.log(retval)\n        this.project = retval;\n        this.project.layer_groups.forEach( (lg)=> {\n          console.log(lg)\n          this.map.addLayer(lg.feature_group);\n        });\n      } else {\n        retval.forEach( (f) => {\n          this.active_layer_group.feature_group.addLayer(f);\n        });\n\n        this.map.fitBounds(this.active_layer_group.feature_group.getBounds());\n      }\n      this.loading = false;\n      $('#file_picker').val('');\n    });\n\n  }\n\n  update_layer_style (prop) {\n    this.current_layer.setStyle({prop: this.current_layer.options[prop]});\n  }\n\n  save_locally () {\n    this.GeoDataService.save_locally(this.project);\n  }\n\n  save_to_depot () {\n    this.loading = true;\n    this.GeoDataService.save_to_depot(this.project).then( (resp) => {\n      this.loading = false;\n    });\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","export default function customOnChange() {\n  return {\n    restrict: 'A',\n    scope: {\n      handler: '&'\n    },\n    link: function (scope, element, attrs) {\n      element.on('change', function (ev) {\n        scope.$apply(function(){\n          scope.handler({ev:ev});\n        });\n      });\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","import * as GeoUtils from '../utils/geo-utils';\nimport LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\n\n\nexport default class GeoDataService {\n\n  constructor ($http, $q, UserService) {\n    'ngInject';\n    this.$http = $http;\n    this.$q = $q;\n    this.UserService = UserService;\n    this.image_icon = L.divIcon({\n      iconSize: [40, 40],\n      html: \"<div style='background-color:red'></div>\",\n      className: 'leaflet-marker-photo'\n    });\n\n  }\n\n  _resize_image (blob, max_width=400, max_height=400) {\n\n    let base64 = this._arrayBufferToBase64(blob);\n    // Create and initialize two canvas\n    var canvas = document.createElement(\"canvas\");\n    var ctx = canvas.getContext(\"2d\");\n    var canvasCopy = document.createElement(\"canvas\");\n    var copyContext = canvasCopy.getContext(\"2d\");\n\n    // Create original image\n    var img = new Image();\n    img.src = base64;\n\n    // Determine new ratio based on max size\n    var ratio = 1;\n    if(img.width > max_width)\n      ratio = max_width / img.width;\n    else if(img.height > max_height)\n      ratio = max_height / img.height;\n\n    // Draw original image in second canvas\n    canvasCopy.width = img.width;\n    canvasCopy.height = img.height;\n    copyContext.drawImage(img, 0, 0);\n\n    // Copy and resize second canvas to first canvas\n    canvas.width = img.width * ratio;\n    canvas.height = img.height * ratio;\n    ctx.drawImage(canvasCopy, 0, 0, canvasCopy.width, canvasCopy.height, 0, 0, canvas.width, canvas.height);\n\n    return canvas.toDataURL();\n  }\n\n  _arrayBufferToBase64( buffer ) {\n    let binary = '';\n    let bytes = new Uint8Array( buffer );\n    let len = bytes.byteLength;\n    for (let i = 0; i < len; i++) {\n        binary += String.fromCharCode( bytes[ i ] );\n    }\n    let encoded =  btoa( binary );\n    return 'data:image/jpg;base64,' + encoded;\n  }\n\n  _from_kml(text_blob) {\n    return this.$q( (res, rej) => {\n      let features = [];\n      let l = omnivore.kml.parse(text_blob);\n      l.getLayers().forEach((d) => {\n        d.feature.properties = {};\n        features.push(d);\n      });\n      res(features);\n    });\n  }\n\n  _from_kmz (blob) {\n    return this.$q( (res, rej) => {\n      let zipper = new JSZip();\n      zipper.loadAsync(blob).then( (zip) => {\n\n        //loop over all the files in the archive\n        for (let key in zip.files) {\n          let ext = key.split('.').pop();\n          if (ext === 'kml') {\n            return zip.files[key].async('text');\n          }\n        }\n      }).then( (txt) => {\n        let features = this._from_kml(txt);\n        res(features);\n      });\n    });\n  }\n\n  _from_json (blob) {\n    return this.$q( (res, rej) => {\n      let features = [];\n      L.geoJSON(blob).getLayers().forEach( (l) => {\n        features.push(l);\n      });\n      res(features);\n    });\n  }\n\n  _from_gpx (blob) {\n    return this.$q( (res, rej) => {\n      // console.log(text_blob)\n      let features = [];\n      let l = omnivore.gpx.parse(blob);\n      l.getLayers().forEach((d) => {\n        features.push(d);\n      });\n      res(features);\n    });\n  }\n\n  _make_image_marker (lat, lon, thumb, preview) {\n    let icon = L.divIcon({\n      iconSize: [40, 40],\n      html: \"<div class='image' style='background:url(\" + thumb + \");background-size: 100% 100%'></div>\",\n      className: 'leaflet-marker-photo'\n    });\n\n    let marker = L.marker([lat, lon], {icon: icon})\n          .bindPopup(\"<img src=\" + preview + \">\",\n              {\n                className: 'leaflet-popup-photo',\n                maxWidth: \"auto\",\n                // maxHeight: 400\n              });\n\n    return marker;\n  }\n\n  _from_image (file) {\n    return this.$q( (res, rej) => {\n      let exif = EXIF.readFromBinaryFile(file);\n      let encoded = this._arrayBufferToBase64(file);\n      let lat = exif.GPSLatitude;\n      let lon = exif.GPSLongitude;\n\n      //Convert coordinates to WGS84 decimal\n      let latRef = exif.GPSLatitudeRef || \"N\";\n      let lonRef = exif.GPSLongitudeRef || \"W\";\n      lat = (lat[0] + lat[1]/60 + lat[2]/3600) * (latRef == \"N\" ? 1 : -1);\n      lon = (lon[0] + lon[1]/60 + lon[2]/3600) * (lonRef == \"W\" ? -1 : 1);\n      let thumb = this._resize_image(file, 100, 100);\n      let preview = this._resize_image(file, 400, 400);\n      // let hq = this._resize_image(file, 800, 800);\n      let marker = this._make_image_marker(lat, lon, thumb, preview);\n      marker.image_src = preview;\n      res([marker]);\n    });\n  }\n\n\n  _from_dsmap (json) {\n    return this.$q( (res, rej) => {\n      json = JSON.parse(json);\n      let project = new MapProject();\n      project.name = json.name;\n      json.features.forEach( (d)=> {\n        let lg = new LayerGroup(d.label, new L.FeatureGroup());\n        let group = L.geoJSON(d);\n        group.getLayers().forEach( (feat) => {\n          lg.feature_group.addLayer(feat);\n        });\n        project.layer_groups.push(lg);\n      });\n      return res(project);\n    });\n  }\n\n  /*\n  This will return a promise that resolves to an array of features\n  that can be added to a LayerGroup\n  */\n  load_from_local_file (file) {\n    return this.$q( (res, rej) => {\n      let ext = GeoUtils.get_file_extension(file.name);\n      let reader = new FileReader();\n      //\n      if ((ext === 'kmz') || (ext === 'jpeg') || (ext === 'jpg')){\n        reader.readAsArrayBuffer(file);\n      } else {\n        reader.readAsText(file);\n      }\n      reader.onload = (e) => {\n        let p = null;\n        switch (ext) {\n          case 'kml':\n            p =  this._from_kml(e.target.result);\n            break;\n          case 'json':\n            p = this._from_json(e.target.result);\n            break;\n          case 'geojson':\n            p = this._from_json(e.target.result);\n            break;\n          case 'kmz':\n            p = this._from_kmz(e.target.result);\n            break;\n          case 'gpx':\n            p = this._from_gpx(e.target.result);\n            break;\n          case 'jpeg':\n            p = this._from_image(e.target.result);\n            break;\n          case 'jpg':\n            p = this._from_image(e.target.result);\n            break;\n          case 'dsmap':\n            p = this._from_dsmap(e.target.result);\n            break;\n          default:\n            p = this._from_json(e.target.result);\n        }\n        return res(p);\n      };\n    });\n  }\n\n  //\n  // @param f: a file from DataService\n  // returns a promise with the LayerGroup\n  load_from_data_depot(f) {\n    let ext = GeoUtils.get_file_extension(f.name);\n    let responseType = 'text';\n    if ((ext === 'kmz') || (ext === 'jpg') || (ext === 'jpeg')) {\n      responseType = 'arraybuffer';\n    }\n    return this.$http.get(f.agaveUrl(), {'responseType': responseType}).then((resp) => {\n      console.log(resp)\n      let p = null;\n      switch (ext) {\n        case 'kml':\n          p =  this._from_kml(resp.data);\n          break;\n        case 'json':\n          p = this._from_json(resp.data);\n          break;\n        case 'geojson':\n          p = this._from_json(resp.data);\n          break;\n        case 'kmz':\n          p = this._from_kmz(resp.data);\n          break;\n        case 'gpx':\n          p = this._from_gpx(resp.data);\n          break;\n        case 'jpeg':\n          p = this._from_image(resp.data);\n          break;\n        case 'jpg':\n          p = this._from_image(resp.data);\n          break;\n        case 'dsmap':\n          p = this._from_dsmap(resp.data);\n          break;\n        default:\n          p = this._from_json(resp.data);\n      }\n      return p;\n    });\n  }\n\n  save_locally (project) {\n    let gjson = project.to_json();\n    let blob = new Blob([JSON.stringify(gjson)], {type: \"application/json\"});\n    let url  = URL.createObjectURL(blob);\n\n    let a = document.createElement('a');\n    a.download    = project.name + \".dsmap\";\n    a.href        = url;\n    a.textContent = \"Download\";\n    a.click();\n  }\n\n  save_to_depot (project) {\n    let gjson = project.to_json();\n    let blob = new Blob([JSON.stringify(gjson)], {type: \"application/json\"});\n    console.log(blob);\n    let base_file_url = 'https://agave.designsafe-ci.org/files/v2/media/system/designsafe.storage.default/' + this.UserService.currentUser().username;\n    let form = new FormData();\n    let file = new File([blob], project.name + '.dsmap');\n\n    form.append('fileToUpload', file, 'test.test.test');\n    return this.$http.post(base_file_url, form, {headers: {'Content-Type': undefined}});\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-data-service.js","export default class GeoStateService {\n\n  constructor ($scope, $state) {\n    this.$scope = $scope;\n    this.$state = $state;\n    this.last_db_path = null;\n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","import {mod as geo_directives} from './directives';\nimport {mod as geo_controllers} from './controllers';\nimport {mod as geo_services} from './services';\n\nlet mod = angular.module('designsafe');\nmod.requires.push('ui.router', 'ang-drag-drop', 'ds.geo.directives', 'ds.geo.controllers', 'ds.geo.services');\n\nfunction config($stateProvider, $uibTooltipProvider) {\n  'ngInject';\n  $stateProvider.state('geo', {\n    url: '',\n    templateUrl: '/static/designsafe/apps/geo/html/map.html',\n    controller: 'MapSidebarCtrl as vm',\n    resolve: {\n      auth: function () {\n        return true;\n      }\n    }\n  }).state('geo.help', {\n    url: '/help',\n    templateUrl: '/static/designsafe/apps/geo/html/help.html',\n    controller: 'HelpCtrl as vm'\n  });\n\n  //config popups etc\n  $uibTooltipProvider.options({popupDelay:1000});\n\n}\n\nmod.config(config);\n\n\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js"],"sourceRoot":""}