{"version":3,"sources":["webpack:///webpack/bootstrap 6fd2e4a7eaa7cc2e13fa","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js"],"names":["mod","angular","module","controller","directive","service","DBModalCtrl","$scope","$uibModalInstance","selected","dismiss","$timeout","$window","$uibModal","DataService","$http","element","hide","primary_color","secondary_color","open_db_modal","streets","L","tileLayer","maxZoom","satellite","control","layers","basemaps","addTo","map","zoomControl","setPosition","invalidateSize","layer_groups","active_layer_group","current_layer","$apply","on","e","object","options","color","fillColor","fillOpacity","feature_group","addLayer","dc","Control","position","draw","circle","edit","featureGroup","remove","lg","push","length","select_active_layer_group","removeLayer","splice","i","show","removeControl","drawControl","add_draw_controls","active","modal","result","then","f","$","click","Marker","Polygon","feature","latLngs","getLatLng","markerBounds","latLngBounds","fitBounds","getBounds","src_lg","getLayers","console","log","get","agaveUrl","geoJSON","resp","data","l","file","ev","target","ext","GeoUtils","get_file_extension","reader","FileReader","readAsText","onload","omnivore","kml","parse","forEach","d","gpx","json","JSON","ds_map","features","bounds","files","readAsArrayBuffer","exif","EXIF","readFromBinaryFile","lat","GPSLatitude","lonRef","GPSLongitudeRef","lon","setStyle","out","map_title","label","blob","Blob","a","document","createElement","href","url","textContent","restrict","scope","handler","link","LayerGroup","show_contents","MapProject","name","GeoStateService","$state","last_db_path","fname","split","pop","requires","config","$stateProvider","$uibTooltipProvider","state","resolve","auth"],"mappings":"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","file":"./designsafe/apps/geo/static/designsafe/apps/geo/scripts/build/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6fd2e4a7eaa7cc2e13fa","import MapSidebarCtrl from './map-sidebar';\nimport DBModalCtrl from './db-modal';\nlet mod = angular.module('ds.geo.controllers', []);\n\nmod.controller('MapSidebarCtrl', MapSidebarCtrl);\nmod.controller('DBModalCtrl', DBModalCtrl);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","import customOnChange from './custom-on-change';\n\nlet mod = angular.module('ds.geo.directives', []);\n\n\nmod.directive('customOnChange', customOnChange);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","// import customOnChange from './custom-on-change';\nimport GeoStateService from './geo-state-service';\n\n\nlet mod = angular.module('ds.geo.services', []);\nmod.service('GeoStateService', GeoStateService);\n\n// mod.directive('customOnChange', customOnChange);\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","export default class DBModalCtrl {\n\n  constructor ($scope, $uibModalInstance) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.selected = null;\n  }\n\n  ok () {\n    this.$uibModalInstance.close(this.selected);\n  };\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","import LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\nimport DBModalCtrl from './db-modal';\nimport * as GeoUtils from '../utils/geo-utils';\n\nexport default class MapSidebarCtrl {\n\n  constructor ($scope, $window, $timeout, $uibModal, DataService, $http) {\n    'ngInject';\n    this.$scope = $scope;\n    this.LGeo = $window.LGeo;\n    this.$timeout = $timeout;\n    this.$window = $window;\n    this.$uibModal = $uibModal;\n    this.DataService = DataService;\n    this.$http = $http;\n    angular.element('header').hide();\n    angular.element('nav').hide();\n    angular.element('footer').hide();\n    this.primary_color = '#ff0000';\n    this.secondary_color = '#ff0000';\n\n    //method binding for callback, sigh...\n    this.local_file_selected = this.local_file_selected.bind(this);\n    this.open_db_modal = this.open_db_modal.bind(this);\n\n    let streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n    });\n\n    let satellite = L.tileLayer(\n      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\n      attribution: '&copy;',\n      maxZoom: 18,\n    });\n\n    let basemaps = {\n      'Street': streets,\n      'Satellite': satellite\n    };\n\n    this.map = L.map('geo_map', {layers: [streets, satellite]}).setView([0, 0], 3);\n    this.map_title = 'New Map';\n    L.control.layers(basemaps).addTo(this.map);\n    this.map.zoomControl.setPosition('bottomleft');\n\n    // trick to fix the tiles that sometimes don't load for some reason...\n    $timeout( () => {this.map.invalidateSize();}, 10);\n\n    this.layer_groups = [new LayerGroup('New Group', new L.FeatureGroup())];\n    this.map.addLayer(this.layer_groups[0].feature_group);\n    this.active_layer_group = this.layer_groups[0];\n\n    // update the current layer to show the details tab\n    this.active_layer_group.feature_group.on('click', (e) => {\n      this.current_layer ? this.current_layer = null : this.current_layer = e.layer;\n      this.$scope.$apply();\n    });\n\n    this.add_draw_controls(this.active_layer_group.feature_group);\n\n    this.map.on('draw:created',  (e) => {\n      let object = e.layer;\n      object.options.color = this.secondary_color;\n      object.options.fillColor = this.primary_color;\n      object.options.fillOpacity = 0.8;\n      this.active_layer_group.feature_group.addLayer(object);\n      this.$scope.$apply();\n    });\n\n    this.map.on('mousemove', (e) => {\n      this.current_mouse_coordinates = e.latlng;\n      this.$scope.$apply();\n    });\n\n\n  } // end constructor\n\n  add_draw_controls (fg) {\n    let dc = new L.Control.Draw({\n      position: 'topright',\n      draw: {\n        circle: false,\n      },\n      edit: {\n       featureGroup: fg,\n       remove: true\n      }\n    });\n    this.map.addControl(dc);\n    this.drawControl = dc;\n  }\n\n\n  create_layer_group () {\n    let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n    this.layer_groups.push(lg);\n    this.active_layer_group = this.layer_groups[this.layer_groups.length -1];\n    this.map.addLayer(lg.feature_group);\n    this.select_active_layer_group(this.active_layer_group);\n  }\n\n  delete_layer_group (lg, i) {\n    this.map.removeLayer(lg.feature_group);\n    this.layer_groups.splice(i, 1);\n  }\n\n  delete_feature (f) {\n    this.map.removeLayer(f);\n    this.active_layer_group.feature_group.removeLayer(f);\n  }\n\n  show_hide_layer_group (lg) {\n    lg.show ? this.map.addLayer(lg.feature_group) : this.map.removeLayer(lg.feature_group);\n  }\n\n  select_active_layer_group(lg) {\n    this.map.removeControl(this.drawControl);\n    this.add_draw_controls(lg.feature_group);\n    this.active_layer_group = lg;\n    lg.active = true;\n    lg.show = true;\n  }\n\n  open_db_modal () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/db-modal.html\",\n      controller: \"DBModalCtrl as vm\",\n    });\n    modal.result.then( (f) => {this.load_from_data_depot(f);});\n  }\n\n  open_file_dialog () {\n    this.$timeout(() => {\n      $('#file_picker').click();\n    }, 0);\n  }\n\n  get_feature_type (f) {\n    if (f instanceof L.Marker) {\n      return 'Point';\n    } else if (f instanceof L.Polygon) {\n      return 'Polygon';\n    } else {\n      return 'Path';\n    }\n  }\n\n  zoom_to(feature) {\n    if (feature instanceof L.Marker) {\n       let latLngs = [ feature.getLatLng() ];\n       let markerBounds = L.latLngBounds(latLngs);\n       this.map.fitBounds(markerBounds);\n    } else {\n      this.map.fitBounds(feature.getBounds());\n    };\n  }\n\n  on_drop (ev, data, lg) {\n    let src_lg = this.layer_groups[data.pidx];\n    let feature = src_lg.feature_group.getLayers()[data.idx];\n    src_lg.feature_group.removeLayer(feature);\n    lg.feature_group.addLayer(feature);\n  }\n\n  drop_feature_success (ev, data, lg) {\n    console.log(\"drag_feature_success\", ev, data, lg)\n    // lg.feature_group.getLayers().splicer(idx, 1);\n  }\n\n  load_from_data_depot(f) {\n    this.$http.get(f.agaveUrl()).then((resp) => {\n      console.log(f, resp.data)\n      let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n      L.geoJSON(resp.data).getLayers().forEach( (l) => {\n        lg.feature_group.addLayer(l);\n      });\n      this.layer_groups.push(lg);\n      this.map.addLayer(lg.feature_group);\n    });\n  }\n\n  local_file_selected (ev) {\n    let file = ev.target.files[0];\n    console.log(GeoUtils);\n\n    let ext = GeoUtils.get_file_extension(file.name);\n    console.log(ext);\n    let reader = new FileReader();\n    reader.readAsText(file);\n    reader.onload = (e) => {\n      if (ext === 'kml') {\n        let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n        // let parser = new this.$window.DOMParser();\n        // let parsed = parser.parseFromString(e.target.result, 'text/xml');\n        let l = omnivore.kml.parse(e.target.result);\n        // debugger\n        l.getLayers().forEach((d) => {\n          lg.feature_group.addLayer(d);\n        });\n        this.layer_groups.push(lg);\n        this.map.addLayer(lg.feature_group);\n      } else if (ext === 'gpx') {\n        let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n        // let parser = new this.$window.DOMParser();\n        // let parsed = parser.parseFromString(e.target.result, 'text/xml');\n        let l = omnivore.gpx.parse(e.target.result);\n        lg.feature_group.addLayer(l);\n\n        this.layer_groups.push(lg);\n        this.map.addLayer(lg.feature_group);\n      } else {\n        let json = JSON.parse(e.target.result);\n\n        // we add in a field into the json blob when saved. If it is such,\n        // handle potential multiple layers.\n        if (json.ds_map) {\n          // each feature in the collection represents a layer\n          json.features.forEach( (f) => {\n            let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n            L.geoJSON(f).getLayers().forEach( (l) => {\n              lg.feature_group.addLayer(l);\n            });\n            this.layer_groups.push(lg);\n            this.map.addLayer(lg.feature_group);\n          });\n        }\n        else {\n          let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n          L.geoJSON(json).getLayers().forEach( (l) => {\n            this.layer_groups[0].feature_group.addLayer(l);\n          });\n          this.layer_groups.push(lg);\n          this.map.addLayer(lg.feature_group);\n        }\n\n      };\n      let bounds = [];\n      this.layer_groups.forEach((lg) =>  {\n        bounds.push(lg.feature_group.getBounds());\n      });\n      this.map.fitBounds(bounds);\n    };\n  }\n\n  load_image (ev) {\n    var files = ev.target.files;\n    for (let i = 0; i < files.length; i++) {\n      let file = files[0];\n      let reader = new FileReader; // use HTML5 file reader to get the file\n\n      reader.readAsArrayBuffer(file);\n      reader.onloadend = (e) => {\n          // get EXIF data\n          let exif = EXIF.readFromBinaryFile(e.target.result);\n\n          let lat = exif.GPSLatitude;\n          let lon = exif.GPSLongitude;\n\n          //Convert coordinates to WGS84 decimal\n          let latRef = exif.GPSLatitudeRef || \"N\";\n          let lonRef = exif.GPSLongitudeRef || \"W\";\n          lat = (lat[0] + lat[1]/60 + lat[2]/3600) * (latRef == \"N\" ? 1 : -1);\n          lon = (lon[0] + lon[1]/60 + lon[2]/3600) * (lonRef == \"W\" ? -1 : 1);\n\n         //Send the coordinates to your map\n          this.active_layer_group.AddMarker(lat,lon);\n      };\n    }\n  }\n\n  update_layer_style (prop) {\n    this.current_layer.setStyle({prop: this.current_layer.options[prop]});\n  }\n\n\n  save_project () {\n    let out = {\n      \"type\": \"FeatureCollection\",\n      \"features\": [],\n      \"ds_map\": true,\n      \"name\": this.map_title\n    };\n    this.layer_groups.forEach( (lg) => {\n      let json = lg.feature_group.toGeoJSON();\n      //add in any options\n      json.label = lg.label;\n\n      out.features.push(json);\n    });\n    let blob = new Blob([JSON.stringify(out)], {type: \"application/json\"});\n    let url  = URL.createObjectURL(blob);\n\n    let a = document.createElement('a');\n    a.download    = this.map_title + \".json\";\n    a.href        = url;\n    a.textContent = \"Download\";\n    a.click();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","export default function customOnChange() {\n  return {\n    restrict: 'A',\n    scope: {\n      handler: '&'\n    },\n    link: function (scope, element, attrs) {\n      element.on('change', function (ev) {\n        scope.$apply(function(){\n          scope.handler({ev:ev});\n        });\n      });\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","export default class LayerGroup {\n\n  constructor (label, fg) {\n    this.label = label;\n    this.feature_group = fg;\n    this.show = true;\n    this.show_contents = true;\n  }\n\n  num_features () {\n    return this.feature_group.getLayers().length;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","\nexport default class MapProject {\n\n  constructor (name) {\n    this.name = name;\n    this.layer_groups = [];\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","export default class GeoStateService {\n\n  constructor ($scope, $state) {\n    this.$scope = $scope;\n    this.$state = $state;\n    this.last_db_path = null;\n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","export function get_file_extension (fname) {\n  return fname.split('.').pop();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","import {mod as geo_directives} from './directives';\nimport {mod as geo_controllers} from './controllers';\nimport {mod as geo_services} from './services';\n\nlet mod = angular.module('designsafe');\nmod.requires.push('ui.router', 'ang-drag-drop', 'ds.geo.directives', 'ds.geo.controllers', 'ds.geo.services');\n\nfunction config($stateProvider, $uibTooltipProvider) {\n  'ngInject';\n  $stateProvider.state('geo', {\n    url: '',\n    templateUrl: '/static/designsafe/apps/geo/html/map.html',\n    controller: 'MapSidebarCtrl as vm',\n    resolve: {\n      auth: function () {\n        return true;\n      }\n    }\n  });\n\n  //config popups etc\n  $uibTooltipProvider.options({popupDelay:1000});\n\n}\n\nmod.config(config);\n\n\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js"],"sourceRoot":""}