{"version":3,"sources":["webpack:///webpack/bootstrap 6b69a89b3d5244d96b02","webpack:///external \"L\"","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","webpack:///external \"angular\"","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/image-overlay-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/help.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/settings-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/confirm-clear-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/image-preview-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-data-service.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-settings-service.js"],"names":["get_file_extension","fname","split","pop","toLowerCase","RESERVED_KEYS","LayerGroup","label","fg","feature_group","show","show_contents","getLayers","length","f","options","thumb_src","L","Marker","Polygon","GeoUtils","MapProject","name","layer_groups","description","forEach","lg","clearLayers","bounds","push","getBounds","total","num_features","out","lg_idx","tmp","feature","json","toGeoJSON","key","indexOf","properties","layer_group_index","JSON","parse","toJson","features","DBModalCtrl","$scope","$uibModalInstance","filename","selected","saveas","dismiss","mod","angular","module","config","$stateProvider","$uibTooltipProvider","$urlRouterProvider","$locationProvider","toastrConfig","extend","abstract","templateUrl","resolve","auth","state","url","controller","when","directive","restrict","scope","handler","link","element","$apply","ev","MapSidebarCtrl","$timeout","$interval","$window","$q","$uibModal","DataService","$http","GeoDataService","GeoSettingsService","toastr","settings","local_file_selected","streets","tileLayer","attribution","satellite","basemaps","map","layers","preferCanvas","setView","mc","Control","Measure","addTo","control","zoomControl","setPosition","HazmapperDivIcon","project","current_project","_init_map_layers","fit_map_to_project","active_layer_group","add_draw_controls","object","e","layer","color","default_stroke_color","fillColor","fillOpacity","addLayer","getElement","style","default_marker_color","on","$on","fitBounds","console","position","draw","circle","marker","icon","edit","featureGroup","remove","addControl","current_layer","l","active","removeLayer","click","feature_click","select_active_layer_group","create_layer_group","modal","open","result","then","s","eachLayer","clear","p","latLngs","markerBounds","latLngBounds","log","src_lg","styles","prop","setStyle","metadata","k","v","adding_metadata","metadata_key","retval","open_existing","error","open_file_dialog","open_db_modal","size","res","file","data","overlay","imageOverlay","$","loading","err","reqs","prom","load_from_local_file","all","val","success","rej","save_to_depot","min_lat","max_lat","min_lon","max_lon","ConfirmClearModalCtrl","ImagePreviewModal","service","GeoStateService","$rootScope","UserService","active_project","className","html","iconSize","iconAnchor","max_width","canvas","document","createElement","ctx","copyContext","canvasCopy","getContext","img","Image","src","base64","onload","ratio","width","max_height","height","drawImage","toDataURL","buffer","binary","bytes","Uint8Array","len","byteLength","text_blob","d","blob","zipper","ext","txt","_from_kml","pointToLayer","latlng","geoJSON","_make_image_marker","lat","props","href","maxWidth","$broadcast","image_src","agave_file","exif","lon","GPSLongitude","lonRef","GPSLongitudeRef","thumb","preview","_resize_image","resp","opacity","getLatLng","reader","readAsDataURL","readAsArrayBuffer","readAsText","target","_from_json","_from_kmz","_from_gpx","_from_image","_from_dsmap","responseType","get","agaveUrl","gjson","Blob","stringify","a","textContent","body","removeChild","form","to_json","post_url","base_file_url","path","type","File","append","post","default_fill_color","default_fill_opacity"],"mappings":"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","file":"./designsafe/apps/geo/static/designsafe/apps/geo/build/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6b69a89b3d5244d96b02","module.exports = L;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"L\"\n// module id = 0\n// module chunks = 0 1","function get_file_extension (fname) {\n  return fname.split('.').pop().toLowerCase();\n}\n\nconst RESERVED_KEYS = [\n  'label',\n  'color',\n  'fillColor',\n  'fillOpacity',\n  'description',\n  'image_src',\n  'thumb_src',\n  'href',\n  'metadata'\n];\n\nexport {RESERVED_KEYS, get_file_extension};\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","export default class LayerGroup {\n\n  constructor (label, fg) {\n    this.label = label;\n    this.feature_group = fg;\n    this.show = true;\n    this.show_contents = true;\n  }\n\n  num_features () {\n    return this.feature_group.getLayers().length;\n  }\n\n  get_feature_type (f) {\n    // debugger\n    if (f.options.thumb_src) {\n      return 'Image';\n    } else if (f instanceof L.Marker) {\n      return 'Point';\n    } else if (f instanceof L.Polygon) {\n      return 'Polygon';\n    } else {\n      return 'Path';\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","import L from 'L';\nimport * as GeoUtils from '../utils/geo-utils';\nimport angular from 'angular';\n\nexport default class MapProject {\n\n  constructor (name) {\n    this.name = name;\n    this.layer_groups = [];\n    this.description = null;\n  }\n\n  clear() {\n    this.layer_groups.forEach( (lg) => {\n      lg.feature_group.clearLayers();\n    });\n  }\n\n  get_bounds() {\n    let bounds = [];\n    this.layer_groups.forEach( (lg) => {\n      bounds.push(lg.feature_group.getBounds());\n    });\n    return bounds;\n  }\n\n  num_features () {\n    total = 0;\n    this.layer_groups.forEach( (lg) => {\n      total += lg.num_features();\n    });\n  }\n\n  to_json() {\n    let out = {\n      \"type\": \"FeatureCollection\",\n      \"features\": [],\n      \"ds_map\": true,\n      \"name\": this.name,\n      \"description\": this.description,\n      \"num_layers\": this.layer_groups.length,\n      \"layer_groups\": []\n    };\n    this.layer_groups.forEach( (lg, lg_idx) => {\n      out.layer_groups.push(lg.label);\n      let tmp = {\n        \"type\": \"FeatureCollection\",\n        \"features\": [],\n        \"label\": lg.label\n      };\n      lg.feature_group.getLayers().forEach( (feature) => {\n        let json = feature.toGeoJSON();\n        // These are all the keys in the options object that we need to\n        // re-create the layers in the application after loading.\n\n\n        for (let key in feature.options) {\n          if (GeoUtils.RESERVED_KEYS.indexOf(key) !== -1) {\n            json.properties[key] = feature.options[key];\n          }\n        };\n        json.layer_group_index = lg_idx;\n\n        //this strips out all the $$angular cruft\n        json = JSON.parse(angular.toJson(json));\n        out.features.push(json);\n      });\n    });\n    return out;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","export default class DBModalCtrl {\n\n  constructor ($scope, $uibModalInstance, filename) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.selected = null;\n    this.saveas = {filename: filename};\n  }\n\n  ok () {\n    this.$uibModalInstance.close({selected:this.selected, saveas:this.saveas.filename});\n  };\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","import {mod as geo_directives} from './directives';\nimport {mod as geo_controllers} from './controllers';\nimport {mod as geo_services} from './services';\n\nlet mod = angular.module('designsafe');\nmod.requires.push('ui.router', 'ang-drag-drop', 'ds.geo.directives', 'ds.geo.controllers', 'ds.geo.services', 'toastr');\n\nfunction config($stateProvider, $uibTooltipProvider, $urlRouterProvider, $locationProvider, toastrConfig) {\n  'ngInject';\n\n  angular.extend(toastrConfig, {\n    timeOut: 1000\n  });\n\n  $locationProvider.html5Mode({\n    enabled: true\n  });\n\n  $stateProvider.state('geo', {\n    url: '',\n    abstract: true,\n    templateUrl: '/static/designsafe/apps/geo/html/index.html',\n    resolve: {\n      auth: function () {\n        return true;\n      }\n    }\n  }).state('geo.map', {\n    url: '/hazmapper',\n    templateUrl: '/static/designsafe/apps/geo/html/map.html',\n    controller: 'MapSidebarCtrl as vm'\n  }).state('geo.help', {\n    url: '/help',\n    templateUrl: '/static/designsafe/apps/geo/html/help.html',\n    controller: 'HelpCtrl as vm'\n  });\n  $urlRouterProvider.when('/', '/hazmapper');\n\n  //config popups etc\n  $uibTooltipProvider.options({popupDelay:1000});\n\n}\n\nmod.config(config);\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js","import customOnChange from './custom-on-change';\n\nlet mod = angular.module('ds.geo.directives', []);\n\n\nmod.directive('customOnChange', customOnChange);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","export default function customOnChange() {\n  return {\n    restrict: 'A',\n    scope: {\n      handler: '&'\n    },\n    link: function (scope, element, attrs) {\n      element.on('change', function (ev) {\n        scope.$apply(function(){\n          scope.handler({ev:ev});\n        });\n      });\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","import MapSidebarCtrl from './map-sidebar';\nimport DBModalCtrl from './db-modal';\nimport ImageOverlayModalCtrl from './image-overlay-modal.js';\nimport HelpCtrl from './help';\nimport SettingsModalCtrl from './settings-modal';\nimport ConfirmClearModalCtrl from './confirm-clear-modal';\nimport ImagePreviewModal from './image-preview-modal';\n\nlet mod = angular.module('ds.geo.controllers', []);\n\nmod.controller('MapSidebarCtrl', MapSidebarCtrl);\nmod.controller('DBModalCtrl', DBModalCtrl);\nmod.controller('HelpCtrl', HelpCtrl);\nmod.controller('SettingsModalCtrl', SettingsModalCtrl);\nmod.controller('ConfirmClearModalCtrl', ConfirmClearModalCtrl);\nmod.controller('ImageOverlayModalCtrl', ImageOverlayModalCtrl);\nmod.controller('ImagePreviewModal', ImagePreviewModal);\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","import LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\nimport DBModalCtrl from './db-modal';\nimport * as GeoUtils from '../utils/geo-utils';\n\nexport default class MapSidebarCtrl {\n\n  constructor ($rootScope, $scope, $window, $timeout, $interval, $q, $uibModal, toastr, DataService, $http, GeoDataService, GeoSettingsService) {\n    'ngInject';\n    this.$rootScope = $rootScope;\n    this.$scope = $scope;\n    this.LGeo = $window.LGeo;\n    this.$timeout = $timeout;\n    this.$interval = $interval;\n    this.$window = $window;\n    this.$q = $q;\n    this.$uibModal = $uibModal;\n    this.DataService = DataService;\n    this.$http = $http;\n    this.GeoDataService = GeoDataService;\n    this.GeoSettingsService = GeoSettingsService;\n    this.toastr = toastr;\n    this.settings = this.GeoSettingsService.settings;\n\n    //method binding for callback, sigh...\n    this.local_file_selected = this.local_file_selected.bind(this);\n    this.feature_click = this.feature_click.bind(this);\n    // this.open_db_modal = this.open_db_modal.bind(this);\n\n    let streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n    });\n\n    let satellite = L.tileLayer(\n      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\n      attribution: '&copy;',\n      maxZoom: 20,\n    });\n\n    let basemaps = {\n      'Street': streets,\n      'Satellite': satellite\n    };\n    this.map = L.map('geo_map', {\n        layers: [streets, satellite],\n        preferCanvas: false\n      }).setView([0, 0], 3);\n    this.mc = new L.Control.Measure({primaryLengthUnit:'meters', primaryAreaUnit: 'meters'});\n    this.mc.addTo(this.map);\n    L.control.layers(basemaps).addTo(this.map);\n    this.map.zoomControl.setPosition('bottomleft');\n\n    // Overload the default marker icon\n    this.HazmapperDivIcon = GeoDataService.HazmapperDivIcon;\n\n    // Load in a map project from the data service if one does exist, if not\n    // create a new one from scratch\n    if (this.GeoDataService.current_project()) {\n      this.project = this.GeoDataService.current_project();\n\n      this._init_map_layers();\n      this.fit_map_to_project();\n\n    } else {\n      this.project = new MapProject('New Map');\n      this.project.layer_groups = [new LayerGroup('New Group', new L.FeatureGroup())];\n      this.map.addLayer(this.project.layer_groups[0].feature_group);\n    }\n\n    // this._add_click_handlers();\n\n    // trick to fix the tiles that sometimes don't load for some reason...\n    $timeout( () => {this.map.invalidateSize();}, 10);\n\n    // init an active layer group\n    this.active_layer_group = this.project.layer_groups[0];\n\n    // Auto keep track of current project in the GeoDataService\n    // so that if they switch states they will not lose work...\n    $interval( () => {\n      this.GeoDataService.current_project(this.project);\n    }, 1000);\n\n    this.add_draw_controls(this.active_layer_group.feature_group);\n\n    // This handles making sure that the features that get created with the draw tool\n    // are styled with the default colors etc.\n    this.map.on('draw:created',  (e) => {\n      let object = e.layer;\n      object.options.color = this.settings.default_stroke_color;\n      object.options.fillColor = this.settings.default_fill_color;\n      object.options.fillOpacity = this.settings.default_fill_opacity;\n      this.active_layer_group.feature_group.addLayer(object);\n      if (object instanceof L.Marker) {\n        object.getElement().style.color = this.settings.default_marker_color;\n        object.options.fillColor = this.settings.default_marker_color;\n\n      }\n      this._init_map_layers();\n      this.$scope.$apply();\n    });\n\n    this.map.on('mousemove', (e) => {\n      this.current_mouse_coordinates = e.latlng;\n      this.$scope.$apply();\n    });\n\n    this.$scope.$on('image_popupopen', (e,d) => {\n      // console.log(e, d);\n      this.active_image_marker = d;\n    });\n    this.$scope.$on('image_popupclose', (e,d) => {\n      // console.log(e, d);\n      this.active_image_marker = null;\n    });\n\n  } // end constructor\n\n  fit_map_to_project() {\n    try {\n      this.map.fitBounds(this.project.get_bounds(), {maxZoom: 16});\n    } catch (e) {\n      console.log('get_bounds fail', e);\n    }\n  }\n\n  add_draw_controls (fg) {\n    let dc = new L.Control.Draw({\n      position: 'topright',\n      draw: {\n        circle: false,\n        marker: {\n          icon: this.HazmapperDivIcon\n        }\n      },\n      edit: {\n       featureGroup: fg,\n       remove: true\n      }\n    });\n    this.map.addControl(dc);\n    this.drawControl = dc;\n  }\n\n  feature_click (e) {\n    let layer = e.target;\n    this.current_layer = null;\n    this.project.layer_groups.forEach( (lg)=>{\n      lg.feature_group.getLayers().forEach( (l)=> {\n          if (l == layer) {\n            l.active = true;\n          } else {\n            l.active = false;\n          }\n      });\n    });\n    this.$scope.$apply();\n  }\n\n  _init_map_layers() {\n    // For some reason, need to readd the feature groups for markers to be displayed correctly???\n    this.project.layer_groups.forEach( (lg)=>{\n      // lg.feature_group.getLayers().forEach( (layer)=>{\n      //   this.map.addLayer(layer);\n      // });\n      // this.map.addLayer(lg.feature_group);\n      this.map.removeLayer(lg.feature_group);\n      this.map.addLayer(lg.feature_group);\n      lg.feature_group.getLayers().forEach( (layer) => {\n        if ( (layer instanceof L.Marker) && (!(layer.options.image_src)) ){\n          layer.getElement().style.color = layer.options.fillColor;\n        }\n        layer.on({\n          click: this.feature_click\n        });\n      });\n    });\n    if (!(this.active_layer_group)) {\n      this.active_layer_group = this.project.layer_groups[0];\n    }\n  }\n\n  create_layer_group () {\n    let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n    this.project.layer_groups.push(lg);\n    this.active_layer_group = this.project.layer_groups[this.project.layer_groups.length -1];\n    this.map.addLayer(lg.feature_group);\n    this.select_active_layer_group(this.active_layer_group);\n  }\n\n  delete_layer_group (lg, i) {\n    this.map.removeLayer(lg.feature_group);\n    this.project.layer_groups.splice(i, 1);\n    if (this.project.layer_groups.length === 0) {\n      this.create_layer_group();\n    }\n    this.active_layer_group = this.project.layer_groups[0];\n  }\n\n  delete_feature (lg, f) {\n    this.map.removeLayer(f);\n    lg.feature_group.removeLayer(f);\n  }\n\n  show_hide_layer_group (lg) {\n    lg.show ? this.map.addLayer(lg.feature_group) : this.map.removeLayer(lg.feature_group);\n  }\n\n  select_active_layer_group(lg) {\n    this.map.removeControl(this.drawControl);\n    this.add_draw_controls(lg.feature_group);\n    this.active_layer_group = lg;\n    lg.active = true;\n    lg.show = true;\n  }\n\n  _deactivate_all_features() {\n    this.project.layer_groups.forEach( (lg)=>{\n      lg.feature_group.getLayers().forEach( (layer) => {\n        layer.active = false;\n      });\n    });\n  }\n\n  select_feature(lg, feature) {\n    this._deactivate_all_features();\n    this.active_layer_group = lg;\n    if (this.current_layer == feature) {\n      feature.active = false;\n      this.current_layer = null;\n    } else {\n      this.current_layer = feature;\n      feature.active = true;\n    }\n  }\n\n  create_new_project () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/confirm-new-modal.html\",\n      controller: \"ConfirmClearModalCtrl as vm\",\n    });\n    modal.result.then( (s) => {\n      this.map.eachLayer(function (layer) {\n        console.log(layer);\n        // this.map.removeLayer(layer);\n      });\n      this.project.clear();\n      let p = new MapProject('New Map');\n      p.layer_groups = [new LayerGroup('New Group', new L.FeatureGroup())];\n      this.project = p;\n      this.active_layer_group = this.project.layer_groups[0];\n      this.map.addLayer(this.active_layer_group.feature_group);\n    });\n  }\n\n  zoom_to(feature) {\n    if (feature instanceof L.Marker) {\n       let latLngs = [ feature.getLatLng() ];\n       let markerBounds = L.latLngBounds(latLngs);\n       try {\n         this.map.fitBounds(markerBounds, {maxZoom: 16});\n        //  feature.getElement().style.border = '2px solid red';\n       } catch (e) {\n         console.log(e);\n       }\n    } else {\n      try {\n        this.map.fitBounds(feature.getBounds(), {maxZoom: 16});\n      } catch (e) {\n        console.log(e);\n      }\n    };\n  }\n\n  on_drop (ev, data, lg) {\n    let src_lg = this.project.layer_groups[data.pidx];\n    let feature = src_lg.feature_group.getLayers()[data.idx];\n    src_lg.feature_group.removeLayer(feature);\n    lg.feature_group.addLayer(feature);\n    this._init_map_layers();\n  }\n\n  update_layer_style (prop) {\n    let tmp = this.current_layer;\n    let styles = {};\n    styles[prop] = this.current_layer.options[prop];\n    if (tmp instanceof L.Marker) {\n        tmp.getElement().style.color = this.current_layer.options.fillColor;\n    } else {\n      this.current_layer.setStyle(styles);\n    }\n  }\n\n  update_feature(layer){\n    layer.update();\n  }\n\n  metadata_save(k, v, layer) {\n    if (!(layer.options.metadata)) {\n      layer.options.metadata = [];\n    }\n    layer.options.metadata.push({\n      'key':k,\n      'value':v\n    });\n    this.adding_metadata = false;\n    this.metadata_key = null;\n    this.metadata_value = null;\n  }\n\n  metadata_delete(idx, layer) {\n    layer.options.metadata.splice(idx, 1);\n  }\n\n  drop_feature_success (ev, data, lg) {\n\n  }\n\n  _load_data_success (retval) {\n    if (this.open_existing) {\n      if (retval instanceof MapProject) {\n        //clear off all the layers from the map\n        this.project.layer_groups.forEach( (lg) => {\n          this.map.removeLayer(lg.feature_group);\n        });\n\n        // set the project to be the return value\n        this.project = retval;\n        this._init_map_layers();\n        this.fit_map_to_project();\n      } else {\n        this.toastr.error('Load failed! File was not compatible');\n      }\n      this.open_existing = false;\n    } else if (retval instanceof MapProject) {\n      retval.layer_groups.forEach( (lg) => {\n        this.project.layer_groups.push(lg);\n        this.map.addLayer(lg.feature_group);\n      });\n      this.active_layer_group = this.project.layer_groups[0];\n      this.fit_map_to_project();\n    } else {\n\n      if (this.project.layer_groups.length == 0) {\n        this.project.layer_groups = [new LayerGroup('New Group', new L.FeatureGroup())];\n        this.active_layer_group = this.project.layer_groups[0];\n        this.map.addLayer(this.project.layer_groups[0].feature_group);\n      }\n      //it will be an array of features...\n      retval.forEach( (f) => {\n        this.active_layer_group.feature_group.addLayer(f);\n      });\n      this.fit_map_to_project();\n      this._init_map_layers();\n    }\n  }\n\n  open_existing_locally () {\n    this.open_existing = true;\n    this.open_file_dialog();\n  }\n\n  open_existing_from_depot() {\n    this.open_existing = true;\n    this.open_db_modal();\n  }\n\n  open_db_modal () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/db-modal.html\",\n      controller: \"DBModalCtrl as vm\",\n      resolve: {\n        filename: ()=> {return null;}\n      }\n    });\n    modal.result.then( (f, saveas) => {this.load_from_data_depot(f);});\n  }\n\n  open_image_preview_modal (href) {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/image-preview-modal.html\",\n      controller: \"ImagePreviewModal as vm\",\n      size: 'lg',\n      resolve: {\n        marker: ()=> {return this.active_image_marker;}\n      }\n    });\n    modal.result.then( (f, saveas) => {this.load_from_data_depot(f);});\n  }\n\n  open_settings_modal () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/settings-modal.html\",\n      controller: \"SettingsModalCtrl as vm\",\n    });\n    modal.result.then( (s) => {\n      this.settings = this.GeoSettingsService.settings;\n\n    });\n  }\n\n  open_image_overlay_modal () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/image-overlay-modal.html\",\n      controller: \"ImageOverlayModalCtrl as vm\",\n    });\n    modal.result.then( (res) => {\n      let bounds;\n      bounds = [\n        [res.min_lat, res.min_lon],\n        [res.max_lat, res.max_lon]\n      ];\n      if (res.file) {\n        this.GeoDataService.read_file_as_data_url(res.file).then( (data) => {\n          console.log(data);\n        });\n      }\n      let overlay = L.imageOverlay(res.url, bounds).addTo(this.map);\n      console.log(overlay);\n    });\n  }\n\n  open_file_dialog () {\n    this.$timeout(() => {\n      $('#file_picker').click();\n    }, 0);\n  }\n\n  load_from_data_depot(f) {\n    this.loading = true;\n    this.GeoDataService.load_from_data_depot(f.selected)\n      .then(\n      (retval) =>{\n        this._load_data_success(retval);\n        this.loading = false;\n      },\n      (err)=> {\n        this.toastr.error('Load failed!');\n        this.loading = false;\n        this.open_existing = false;\n      });\n  }\n\n  local_file_selected (ev) {\n    this.loading = true;\n    let reqs = [];\n    for (let i=0; i<ev.target.files.length; i++) {\n      // debugger\n      let file = ev.target.files[i];\n      let prom = this.GeoDataService.load_from_local_file(file).then( (retval) =>{return this._load_data_success(retval);});\n      reqs.push(prom);\n      // this.loading = false;\n    };\n    this.$q.all(reqs).then( ()=>{\n      this.loading = false;\n      //reset the picker\n      $('#file_picker').val('');\n      this.toastr.success('Imported file');\n    }, (rej)=>{\n      this.loading = false;\n      this.toastr.error('Load failed!');\n    }).then( () => {\n\n    });\n  }\n\n  save_locally () {\n    this.GeoDataService.save_locally(this.project);\n  }\n\n  save_to_depot () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/db-modal.html\",\n      controller: \"DBModalCtrl as vm\",\n      resolve: {\n        filename: ()=> {return this.project.name + '.geojson';}\n      }\n    });\n    modal.result.then( (res) => {\n      let newname = res.saveas;\n      this.project.name = newname.split('.')[0];\n      res.selected.name = res.saveas;\n      this.loading = true;\n      this.GeoDataService.save_to_depot(this.project, res.selected).then( (resp) => {\n        this.loading = false;\n        this.toastr.success('Saved to data depot');\n      }, (err) => {\n        this.toastr.error('Save failed!');\n        this.loading = false;\n      });\n    }, (rej)=> {\n      this.loading = false;\n    });\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","module.exports = angular;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"angular\"\n// module id = 21\n// module chunks = 0","export default class ImageOverlayModalCtrl {\n\n  constructor ($scope, $uibModalInstance) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.data = {\n      file: null,\n      url: null,\n      min_lat: null,\n      max_lat: null,\n      min_lon: null,\n      max_lon: null\n    };\n  }\n\n  ok () {\n    this.$uibModalInstance.close(this.data);\n  };\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/image-overlay-modal.js","export default class HelpCtrl {\n\n  constructor ($scope) {\n    'ngInject';\n    this.$scope = $scope;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/help.js","export default class SettingsModalCtrl {\n\n  constructor ($scope, $uibModalInstance, GeoSettingsService) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.GeoSettingsService = GeoSettingsService;\n    this.settings = GeoSettingsService.settings;\n  }\n\n  ok () {\n    this.GeoSettingsService.settings = this.settings;\n    this.$uibModalInstance.close(this.settings);\n  };\n\n  // cancel () {\n  //   this.$uibModalInstance.dismiss('cancel');\n  // };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/settings-modal.js","export default class ConfirmClearModalCtrl {\n\n  constructor ($scope, $uibModalInstance, GeoSettingsService) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n  }\n\n  ok () {\n    this.$uibModalInstance.close('ok');\n  };\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/confirm-clear-modal.js","export default class ImagePreviewModal {\n\n  constructor ($scope, $uibModalInstance, GeoDataService, marker) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.GeoDataService = GeoDataService;\n    this.marker = marker;\n    console.log(\"ImagePreviewModal\", this.marker);\n  }\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/image-preview-modal.js","// import customOnChange from './custom-on-change';\nimport GeoStateService from './geo-state-service';\nimport GeoDataService from './geo-data-service';\nimport GeoSettingsService from './geo-settings-service';\n\nlet mod = angular.module('ds.geo.services', []);\nmod.service('GeoStateService', GeoStateService);\nmod.service('GeoDataService', GeoDataService);\nmod.service('GeoSettingsService', GeoSettingsService);\n\n// mod.directive('customOnChange', customOnChange);\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","export default class GeoStateService {\n\n  constructor ($scope, $state) {\n    this.$scope = $scope;\n    this.$state = $state;\n    this.last_db_path = null;\n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","import * as GeoUtils from '../utils/geo-utils';\nimport LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\n\n\nexport default class GeoDataService {\n\n  constructor ($http, $q, $rootScope, UserService, GeoSettingsService) {\n    'ngInject';\n    this.$http = $http;\n    this.$q = $q;\n    this.$rootScope = $rootScope;\n    this.UserService = UserService;\n    this.GeoSettingsService = GeoSettingsService;\n    this.active_project = null;\n    this.previous_project_state = null;\n\n    // TODO: Should this marker size be auto somehow?\n    this.HazmapperDivIcon = L.divIcon({\n      className: 'hm-marker',\n      html: \"<div> <i class='fa fa-map-marker'> </i> </div>\",\n      iconSize: [21, 36],\n      iconAnchor: [10.5, 36]\n    });\n  }\n\n  \n\n  current_project(project) {\n    if (!(project)) {\n      return this.active_project;\n    }\n    this.active_project = project;\n  }\n\n  _resize_image (blob, max_width=400, max_height=400) {\n    return this.$q( (res, rej) => {\n      let base64 = this._arrayBufferToBase64(blob);\n      // Create and initialize two canvas\n      let canvas = document.createElement(\"canvas\");\n      let ctx = canvas.getContext(\"2d\");\n      let canvasCopy = document.createElement(\"canvas\");\n      let copyContext = canvasCopy.getContext(\"2d\");\n\n      // Create original image\n      let img = new Image();\n      img.src = base64;\n      img.onload = ()=>{\n        // Determine new ratio based on max size\n        let ratio = 1;\n        if(img.width > max_width) {\n          ratio = max_width / img.width;\n        } else if(img.height > max_height) {\n          ratio = max_height / img.height;\n        }\n        // Draw original image in second canvas\n        canvasCopy.width = img.width;\n        canvasCopy.height = img.height;\n        copyContext.drawImage(img, 0, 0);\n\n        // Copy and resize second canvas to first canvas\n        canvas.width = img.width * ratio;\n        canvas.height = img.height * ratio;\n        ctx.drawImage(canvasCopy, 0, 0, canvasCopy.width, canvasCopy.height, 0, 0, canvas.width, canvas.height);\n        res(canvas.toDataURL('image/jpeg', 0.8));\n      };\n    });\n  }\n\n  _arrayBufferToBase64( buffer ) {\n    let binary = '';\n    let bytes = new Uint8Array( buffer );\n    let len = bytes.byteLength;\n    for (let i = 0; i < len; i++) {\n        binary += String.fromCharCode( bytes[ i ] );\n    }\n    let encoded =  btoa( binary );\n    return 'data:image/jpg;base64,' + encoded;\n  }\n\n  _from_kml(text_blob) {\n    return this.$q( (res, rej) => {\n      let features = [];\n      let l = omnivore.kml.parse(text_blob);\n      l.getLayers().forEach((d) => {\n        // d.feature.properties = {};\n        d.options.label = d.feature.properties.name;\n        features.push(d);\n      });\n      res(features);\n    });\n  }\n\n  _from_kmz (blob) {\n    return this.$q( (res, rej) => {\n      let zipper = new JSZip();\n      zipper.loadAsync(blob).then( (zip) => {\n        //loop over all the files in the archive\n        let proms = [];\n        for (let key in zip.files) {\n          let ext = key.split('.').pop();\n          if (ext === 'kml') {\n            return zip.files[key].async('text');\n          }\n        }\n      }).then( (txt) => {\n        let features = this._from_kml(txt);\n        res(features);\n      });\n    });\n  }\n\n  _from_json (blob) {\n    return this.$q( (res, rej) => {\n      if (blob.ds_map) return res(this._from_dsmap(blob));\n      try {\n        let features = [];\n        let options = {\n          pointToLayer: (feature, latlng)=> {\n            return L.marker(latlng, {icon: this.HazmapperDivIcon});\n          }\n        };\n        L.geoJSON(blob, options).getLayers().forEach( (layer) => {\n\n\n          let props = layer.feature.properties;\n          if ((layer instanceof L.Marker) && (layer.feature.properties.image_src)) {\n            let latlng = layer.getLatLng();\n            layer = this._make_image_marker(latlng.lat, latlng.lng, props.thumb_src, props.image_src, props.href);\n          }\n\n          //add in the optional metadata / reserved props\n          layer.options.metadata = [];\n          for (let key in props) {\n\n            // if the key is not reserved for hazmapper, put it in\n            // the metadata\n            if (GeoUtils.RESERVED_KEYS.indexOf(key) === -1) {\n              layer.options.metadata.push( {\n                \"key\": key,\n                \"value\": props[key]\n              });\n            } else {\n              layer.options[key] = props[key];\n            }\n          }\n          features.push(layer);\n        });\n        res(features);\n      } catch (e) {\n        rej('Bad geoJSON');\n      }\n    });\n  }\n\n  _from_gpx (blob) {\n    return this.$q( (res, rej) => {\n      // console.log(text_blob)\n      let features = [];\n      let l = omnivore.gpx.parse(blob);\n      l.getLayers().forEach((d) => {\n        features.push(d);\n      });\n      res(features);\n    });\n  }\n\n  _make_image_marker (lat, lon, thumb, preview, href=null) {\n    let icon = L.divIcon({\n      iconSize: [40, 40],\n      html: \"<div class='image' style='background:url(\" + thumb + \");background-size: 100% 100%'></div>\",\n      className: 'leaflet-marker-photo'\n    });\n\n    let tmpl = \"<img src=\" + preview + \">\";\n\n    let marker = L.marker([lat, lon], {icon: icon})\n          .bindPopup(tmpl,\n              {\n                className: 'leaflet-popup-photo',\n                maxWidth: \"auto\",\n                // maxHeight: 400\n              });\n    marker.on('popupopen', (e)=> {\n      this.$rootScope.$broadcast(\"image_popupopen\", marker);\n    });\n    marker.on('popupclose', (e)=> {\n      this.$rootScope.$broadcast(\"image_popupclose\", marker);\n    });\n    marker.options.image_src = preview;\n    marker.options.thumb_src = thumb;\n    marker.options.href = href;\n    return marker;\n  }\n\n  _from_image (file, fname, agave_file=null) {\n    return this.$q( (res, rej) => {\n      try {\n        let exif = EXIF.readFromBinaryFile(file);\n        let lat = exif.GPSLatitude;\n        let lon = exif.GPSLongitude;\n        //Convert coordinates to WGS84 decimal\n        let latRef = exif.GPSLatitudeRef || \"N\";\n        let lonRef = exif.GPSLongitudeRef || \"W\";\n        lat = (lat[0] + lat[1]/60 + lat[2]/3600) * (latRef == \"N\" ? 1 : -1);\n        lon = (lon[0] + lon[1]/60 + lon[2]/3600) * (lonRef == \"W\" ? -1 : 1);\n        if ((lat > 90) || (lat < -90) || (lon > 360) || (lon < -360)) {\n          rej('Bad EXIF GPS data');\n        }\n        let thumb = null;\n        let preview = null;\n        this._resize_image(file, 100, 100).then( (resp)=>{\n          thumb = resp;\n        }).then( ()=>{\n          return this._resize_image(file, 400, 400);\n        }).then( (resp)=>{\n          preview = resp;\n          let marker = this._make_image_marker(lat, lon, thumb, preview, null);\n          if (agave_file) {\n            marker.options.href = agave_file._links.self.href;\n            marker.options.label = agave_file.name;\n          } else {\n            marker.options.label = fname;\n          }\n          res([marker]);\n        });\n      } catch (e) {\n        rej(e);\n      }\n    });\n  }\n\n\n  _from_dsmap (json) {\n    return this.$q( (res, rej) => {\n      // if (json instanceof String) {\n      let project = new MapProject();\n      let options = {\n        pointToLayer: (feature, latlng)=> {\n            return L.marker(latlng, {icon: this.HazmapperDivIcon});\n        }\n      };\n      project.name = json.name;\n      project.description = json.description;\n      json.layer_groups.forEach( (name) => {\n        project.layer_groups.push(new LayerGroup(name, new L.FeatureGroup()));\n      });\n      json.features.forEach( (d)=> {\n        let feature = L.geoJSON(d, options);\n        feature.eachLayer( (layer)=> {\n          // If there were no styles applied, it might be transparent???\n          if (!(layer.feature.properties.color)) {\n           layer.feature.properties.color = '#ff0000';\n          };\n          if (!(layer.feature.properties.fillColor)) {\n            layer.feature.properties.fillColor = '#ff0000';\n          };\n          if (!(layer.feature.properties.opacity)) {\n            layer.feature.properties.opacity = 1.0;\n          };\n\n          let props = layer.feature.properties;\n\n          try {\n            let styles = {\n              fillColor: layer.feature.properties.fillColor,\n              color: layer.feature.properties.color,\n              opacity: layer.feature.properties.opacity\n            };\n            layer.setStyle(styles);\n          } catch (e) {\n            // this can get caught for marker type objects, which for some reason\n            // do not have a setStyle() method\n            console.log(e);\n          }\n\n          let layer_group_index = d.layer_group_index;\n          if ((layer instanceof L.Marker) && (layer.feature.properties.image_src)) {\n            let latlng = layer.getLatLng();\n            layer = this._make_image_marker(latlng.lat, latlng.lng, layer.feature.properties.thumb_src, layer.feature.properties.image_src, layer.feature.properties.original_src);\n            // feat.options.image_src = feat.feature.properties.image_src;\n            // feat.options.thumb_src = feat.feature.properties.thumb_src;\n          }\n\n          // Add in the properties that were on the feature\n          for (let key in props) {\n            layer.options[key] = props[key];\n          }\n\n          project.layer_groups[layer_group_index].feature_group.addLayer(layer);\n          // layer.options.label = d.properties.label;\n        });\n\n      });\n      res(project);\n    });\n  }\n\n  read_file_as_data_url(file) {\n\n    let reader = new FileReader();\n    return this.$q( (res, rej) => {\n      reader.readAsDataURL(file);\n\n      reader.onload = (e) => {\n        return res(reader.result);\n      };\n    });\n  }\n\n  /*\n  This will return a promise that resolves to an array of features\n  that can be added to a LayerGroup\n  */\n  load_from_local_file (file) {\n    return this.$q( (res, rej) => {\n      let ext = GeoUtils.get_file_extension(file.name);\n      let reader = new FileReader();\n      //\n      if ((ext === 'kmz') || (ext === 'jpeg') || (ext === 'jpg')){\n        reader.readAsArrayBuffer(file);\n      } else {\n        reader.readAsText(file);\n      }\n      reader.onload = (e) => {\n        let p = null;\n        switch (ext) {\n          case 'kml':\n            p =  this._from_kml(e.target.result);\n            break;\n          case 'json':\n            p = this._from_json(JSON.parse(e.target.result));\n            break;\n          case 'geojson':\n            p = this._from_json(JSON.parse(e.target.result));\n            break;\n          case 'kmz':\n            p = this._from_kmz(e.target.result);\n            break;\n          case 'gpx':\n            p = this._from_gpx(e.target.result);\n            break;\n          case 'jpeg':\n            p = this._from_image(e.target.result, file.name);\n            break;\n          case 'jpg':\n            p = this._from_image(e.target.result, file.name);\n            break;\n          case 'dsmap':\n            p = this._from_dsmap(JSON.parse(e.target.result));\n            break;\n          default:\n            p = this._from_json(JSON.parse(e.target.result));\n        }\n        return res(p);\n      };\n    });\n  }\n\n  //\n  // @param f: a file from DataService\n  // returns a promise with the LayerGroup\n  load_from_data_depot(f) {\n    let ext = GeoUtils.get_file_extension(f.name);\n    let responseType = 'text';\n    if ((ext === 'kmz') || (ext === 'jpg') || (ext === 'jpeg')) {\n      responseType = 'arraybuffer';\n    }\n    return this.$http.get(f.agaveUrl(), {'responseType': responseType}).then((resp) => {\n      let p = null;\n      switch (ext) {\n        case 'kml':\n          p =  this._from_kml(resp.data);\n          break;\n        case 'json':\n          p = this._from_json(resp.data);\n          break;\n        case 'geojson':\n          p = this._from_json(resp.data);\n          break;\n        case 'kmz':\n          p = this._from_kmz(resp.data);\n          break;\n        case 'gpx':\n          p = this._from_gpx(resp.data);\n          break;\n        case 'jpeg':\n          p = this._from_image(resp.data, f.name, f);\n          break;\n        case 'jpg':\n          p = this._from_image(resp.data, f.name, f);\n          break;\n        case 'dsmap':\n          p = this._from_dsmap(resp.data);\n          break;\n        default:\n          p = this._from_json(resp.data);\n      }\n      return p;\n    });\n  }\n\n  save_locally (project) {\n    let gjson = project.to_json();\n    let blob = new Blob([JSON.stringify(gjson)], {type: \"application/json\"});\n    let url  = URL.createObjectURL(blob);\n\n    let a = document.createElement('a');\n    document.body.appendChild(a);\n    a.download    = project.name + \".geojson\";\n    a.href        = url;\n    a.textContent = \"Download\";\n    a.click();\n    document.body.removeChild(a);\n  }\n\n  //TODO Fix that hard coded URL?\n  save_to_depot (project, path) {\n    let form = new FormData();\n    let gjson = project.to_json();\n    let blob = new Blob([JSON.stringify(gjson)], {type: \"application/json\"});\n    let base_file_url = 'https://agave.designsafe-ci.org/files/v2/media/system/';\n    let post_url = base_file_url;\n    post_url = post_url + path.system;\n    let file = null;\n    if (path.type === 'dir') {\n      post_url = post_url + path.path;\n      file = new File([blob], path.name);\n      form.append('fileToUpload', file, path.name);\n    } else {\n      // A file was picked, so this WILL replace it\n      post_url = post_url + path.trail[path.trail.length-2].path;\n      file = new File([blob], path.name);\n      form.append('fileToUpload', file, path.name);\n    }\n    return this.$http.post(post_url, form, {headers: {'Content-Type': undefined}});\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-data-service.js","export default class GeoSettingsService {\n\n  constructor () {\n    this.settings = {\n      default_marker_color: '#71c4ff',\n      default_fill_color: '#ff0000',\n      default_stroke_color: '#ff0000',\n      default_fill_opacity: 0.5,\n      measurement_units: 'si'\n    };\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-settings-service.js"],"sourceRoot":""}