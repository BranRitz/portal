{"version":3,"sources":["webpack:///webpack/bootstrap 5db283462c1d614609cc","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/help.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-data-service.js","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","webpack:///external \"L\"","webpack:///./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js"],"names":["DBModalCtrl","$scope","$uibModalInstance","selected","dismiss","label","fg","feature_group","show","show_contents","getLayers","f","options","image_src","name","layer_groups","description","forEach","lg","clearLayers","bounds","push","getBounds","out","tmp","json","feature","toGeoJSON","opts","_","clone","icon","opt_keys","indexOf","properties","key","features","get_file_extension","fname","split","pop","mod","controller","angular","module","service","HelpCtrl","GeoUtils","MapSidebarCtrl","LGeo","$window","$interval","$q","$uibModal","DataService","$http","GeoDataService","toastr","primary_color","secondary_color","local_file_selected","streets","L","tileLayer","attribution","satellite","basemaps","map","layers","measureControl","preferCanvas","setView","control","zoomControl","project","current_project","addLayer","removeLayer","$timeout","active_layer_group","add_draw_controls","object","e","layer","fillColor","fillOpacity","$apply","on","dc","Control","Draw","position","draw","circle","edit","featureGroup","remove","addControl","select_active_layer_group","active","current_layer","console","log","get_feature_type","modal","open","templateUrl","result","then","load_from_data_depot","$","click","latLngs","markerBounds","latLngBounds","fitBounds","src_lg","retval","clear","get_bounds","loading","reqs","file","ev","prom","load_from_local_file","all","val","success","err","error","customOnChange","restrict","scope","handler","link","element","UserService","previous_project_state","active_project","blob","max_width","max_height","base64","_arrayBufferToBase64","ctx","canvas","getContext","canvasCopy","document","createElement","copyContext","img","Image","src","width","ratio","height","res","toDataURL","len","bytes","byteLength","i","binary","String","encoded","btoa","text_blob","l","omnivore","d","zipper","JSZip","loadAsync","proms","zip","files","ext","async","txt","_from_kml","ds_map","gpx","parse","iconSize","html","className","marker","lat","lon","bindPopup","preview","maxWidth","thumb_src","thumb","exif","EXIF","readFromBinaryFile","GPSLongitude","latRef","GPSLatitudeRef","lonRef","GPSLongitudeRef","_resize_image","resp","geoJSON","eachLayer","layer_group_index","Marker","latlng","getLatLng","_make_image_marker","reader","readAsArrayBuffer","onload","p","target","_from_kmz","responseType","get","agaveUrl","data","url","URL","createObjectURL","a","body","appendChild","download","textContent","removeChild","base_file_url","form","FormData","File","append","post","$state","last_db_path","GeoStateService","requires","config","$stateProvider","$uibTooltipProvider","$locationProvider","html5Mode","abstract","auth","state","$urlRouterProvider","when"],"mappings":"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","file":"./designsafe/apps/geo/static/designsafe/apps/geo/build/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5db283462c1d614609cc","export default class DBModalCtrl {\n\n  constructor ($scope, $uibModalInstance) {\n    'ngInject';\n    this.$scope = $scope;\n    this.$uibModalInstance = $uibModalInstance;\n    this.selected = null;\n  }\n\n  ok () {\n    this.$uibModalInstance.close(this.selected);\n  };\n\n  cancel () {\n    this.$uibModalInstance.dismiss('cancel');\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/db-modal.js","export default class LayerGroup {\n\n  constructor (label, fg) {\n    this.label = label;\n    this.feature_group = fg;\n    this.show = true;\n    this.show_contents = true;\n  }\n\n  num_features () {\n    return this.feature_group.getLayers().length;\n  }\n\n  get_feature_type (f) {\n    if (f.options.image_src) {\n      return 'Image';\n    } else if (f instanceof L.Marker) {\n      return 'Point';\n    } else if (f instanceof L.Polygon) {\n      return 'Polygon';\n    } else {\n      return 'Path';\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/layer_group.js","import L from 'L';\n\nexport default class MapProject {\n\n  constructor (name) {\n    this.name = name;\n    this.layer_groups = [];\n    this.description = null;\n  }\n\n  clear() {\n    this.layer_groups.forEach( (lg) => {\n      lg.feature_group.clearLayers();\n    });\n  }\n\n  get_bounds() {\n    let bounds = [];\n    this.layer_groups.forEach( (lg) => {\n      bounds.push(lg.feature_group.getBounds());\n    });\n    return bounds;\n  }\n\n  to_json() {\n    let out = {\n      \"type\": \"FeatureCollection\",\n      \"features\": [],\n      \"ds_map\": true,\n      \"name\": this.name,\n      \"description\": this.description,\n      \"num_layers\": this.layer_groups.length,\n      \"layer_groups\": []\n    };\n    this.layer_groups.forEach( (lg, lg_idx) => {\n      out.layer_groups.push(lg.label);\n      let tmp = {\n        \"type\": \"FeatureCollection\",\n        \"features\": [],\n        \"label\": lg.label\n      };\n      lg.feature_group.getLayers().forEach( (feature) => {\n        let json = feature.toGeoJSON();\n        let opts = _.clone(feature.options);\n        delete opts.icon;\n        let opt_keys = ['label', 'color', 'fillColor', 'fillOpacity', 'description', 'image_src', 'thumb_src'];\n\n        // //add in any options\n        // if (feature.options.image_src) {\n        //   json.properties.image_src = feature.options.image_src;\n        // }\n        // if (feature.options.thumb_src) {\n        //   json.properties.thumb_src = feature.options.thumb_src;\n        // }\n        for (let key in opts) {\n          if (opt_keys.indexOf(key) !== -1) {\n            json.properties[key] = opts[key];\n          }\n        };\n        json.layer_group_index = lg_idx;\n        out.features.push(json);\n      });\n    });\n    return out;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/models/map-project.js","export function get_file_extension (fname) {\n  return fname.split('.').pop();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/utils/geo-utils.js","import MapSidebarCtrl from './map-sidebar';\nimport DBModalCtrl from './db-modal';\nimport HelpCtrl from './help';\n\nlet mod = angular.module('ds.geo.controllers', []);\n\nmod.controller('MapSidebarCtrl', MapSidebarCtrl);\nmod.controller('DBModalCtrl', DBModalCtrl);\nmod.controller('HelpCtrl', HelpCtrl);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/index.js","import customOnChange from './custom-on-change';\n\nlet mod = angular.module('ds.geo.directives', []);\n\n\nmod.directive('customOnChange', customOnChange);\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/index.js","// import customOnChange from './custom-on-change';\nimport GeoStateService from './geo-state-service';\nimport GeoDataService from './geo-data-service';\n\nlet mod = angular.module('ds.geo.services', []);\nmod.service('GeoStateService', GeoStateService);\nmod.service('GeoDataService', GeoDataService);\n\n// mod.directive('customOnChange', customOnChange);\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/index.js","export default class HelpCtrl {\n\n  constructor ($scope) {\n    'ngInject';\n    this.$scope = $scope;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/help.js","import LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\nimport DBModalCtrl from './db-modal';\nimport * as GeoUtils from '../utils/geo-utils';\n\nexport default class MapSidebarCtrl {\n\n  constructor ($scope, $window, $timeout, $interval, $q, $uibModal, toastr, DataService, $http, GeoDataService) {\n    'ngInject';\n    this.$scope = $scope;\n    this.LGeo = $window.LGeo;\n    this.$timeout = $timeout;\n    this.$interval = $interval;\n    this.$window = $window;\n    this.$q = $q;\n    this.$uibModal = $uibModal;\n    this.DataService = DataService;\n    this.$http = $http;\n    this.GeoDataService = GeoDataService;\n    this.toastr = toastr;\n\n    this.primary_color = '#ff0000';\n    this.secondary_color = '#ff0000';\n\n    //method binding for callback, sigh...\n    this.local_file_selected = this.local_file_selected.bind(this);\n    this.open_db_modal = this.open_db_modal.bind(this);\n\n    let streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n    });\n\n    let satellite = L.tileLayer(\n      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\n      attribution: '&copy;',\n      maxZoom: 20,\n    });\n\n    let basemaps = {\n      'Street': streets,\n      'Satellite': satellite\n    };\n    this.map = L.map('geo_map', {\n        layers: [streets, satellite],\n        measureControl:true,\n        preferCanvas: true\n      }).setView([0, 0], 3);\n    L.control.layers(basemaps).addTo(this.map);\n    this.map.zoomControl.setPosition('bottomleft');\n\n    // this.$scope.$watch(()=>{return this.current_layer;}, (newval, oldval)=>{console.log(newval);});\n\n    if (this.GeoDataService.current_project()) {\n      this.project = this.GeoDataService.current_project();\n      this.project.layer_groups.forEach( (lg)=>{\n        this.map.addLayer(lg.feature_group);\n        this.map.removeLayer(lg.feature_group);\n        this.map.addLayer(lg.feature_group);\n      });\n    } else {\n      this.project = new MapProject('New Map');\n      this.project.layer_groups = [new LayerGroup('New Group', new L.FeatureGroup())];\n      this.map.addLayer(this.project.layer_groups[0].feature_group);\n    }\n\n\n    // trick to fix the tiles that sometimes don't load for some reason...\n    $timeout( () => {this.map.invalidateSize();}, 10);\n\n    this.active_layer_group = this.project.layer_groups[0];\n\n    // Auto keep track of current project in the GeoDataService\n    // so that if they switch states they will not lose work...\n    $interval( () => {\n      this.GeoDataService.current_project(this.project);\n    }, 1000);\n\n    // update the current layer to show the details tab\n    this.active_layer_group.feature_group.on('click', (e) => {\n      // this.current_layer ? this.current_layer = null : this.current_layer = e.layer;\n      // this.$scope.$apply();\n    });\n\n    this.add_draw_controls(this.active_layer_group.feature_group);\n\n    this.map.on('draw:created',  (e) => {\n      let object = e.layer;\n      object.options.color = this.secondary_color;\n      object.options.fillColor = this.primary_color;\n      object.options.fillOpacity = 0.8;\n      this.active_layer_group.feature_group.addLayer(object);\n      this.$scope.$apply();\n    });\n\n    this.map.on('mousemove', (e) => {\n      this.current_mouse_coordinates = e.latlng;\n      this.$scope.$apply();\n    });\n\n\n  } // end constructor\n\n  add_draw_controls (fg) {\n    let dc = new L.Control.Draw({\n      position: 'topright',\n      draw: {\n        circle: false,\n      },\n      edit: {\n       featureGroup: fg,\n       remove: true\n      }\n    });\n    this.map.addControl(dc);\n    this.drawControl = dc;\n  }\n\n\n  create_layer_group () {\n    let lg = new LayerGroup(\"New Group\", new L.FeatureGroup());\n    this.project.layer_groups.push(lg);\n    this.active_layer_group = this.project.layer_groups[this.project.layer_groups.length -1];\n    this.map.addLayer(lg.feature_group);\n    this.select_active_layer_group(this.active_layer_group);\n  }\n\n  delete_layer_group (lg, i) {\n    this.map.removeLayer(lg.feature_group);\n    this.project.layer_groups.splice(i, 1);\n  }\n\n  delete_feature (lg, f) {\n    this.map.removeLayer(f);\n    lg.feature_group.removeLayer(f);\n  }\n\n  show_hide_layer_group (lg) {\n    lg.show ? this.map.addLayer(lg.feature_group) : this.map.removeLayer(lg.feature_group);\n  }\n\n  select_active_layer_group(lg) {\n    this.map.removeControl(this.drawControl);\n    this.add_draw_controls(lg.feature_group);\n    this.active_layer_group = lg;\n    lg.active = true;\n    lg.show = true;\n  }\n\n  select_feature(lg, feature) {\n    this.active_layer_group = lg;\n    this.current_layer == feature ? this.current_layer = null : this.current_layer = feature;\n    console.log(lg.get_feature_type(feature));\n    console.log(feature)\n  }\n\n  open_db_modal () {\n    let modal = this.$uibModal.open({\n      templateUrl: \"/static/designsafe/apps/geo/html/db-modal.html\",\n      controller: \"DBModalCtrl as vm\",\n    });\n    modal.result.then( (f) => {this.load_from_data_depot(f);});\n  }\n\n  open_file_dialog () {\n    this.$timeout(() => {\n      $('#file_picker').click();\n    }, 0);\n  }\n\n  zoom_to(feature) {\n    if (feature instanceof L.Marker) {\n       let latLngs = [ feature.getLatLng() ];\n       let markerBounds = L.latLngBounds(latLngs);\n       this.map.fitBounds(markerBounds);\n    } else {\n      this.map.fitBounds(feature.getBounds());\n    };\n  }\n\n  on_drop (ev, data, lg) {\n    let src_lg = this.project.layer_groups[data.pidx];\n    let feature = src_lg.feature_group.getLayers()[data.idx];\n    src_lg.feature_group.removeLayer(feature);\n    lg.feature_group.addLayer(feature);\n  }\n\n  drop_feature_success (ev, data, lg) {\n    console.log(\"drag_feature_success\", ev, data, lg);\n  }\n\n  _load_data_success (retval) {\n    if (retval instanceof MapProject) {\n      this.project.clear();\n      this.project = retval;\n      this.project.layer_groups.forEach( (lg)=> {\n        this.map.addLayer(lg.feature_group);\n      });\n      this.active_layer_group = this.project.layer_groups[0];\n      this.map.fitBounds(this.project.get_bounds());\n    } else {\n      //it will be an array of features...\n      retval.forEach( (f) => {\n        this.active_layer_group.feature_group.addLayer(f);\n      });\n      this.map.fitBounds(this.active_layer_group.feature_group.getBounds());\n    }\n  }\n\n  load_from_data_depot(f) {\n    this.loading = true;\n    this.GeoDataService.load_from_data_depot(f)\n      .then( (retval) =>{this._load_data_success(retval);})\n      .then( ()=>{ this.loading = false;});\n  }\n\n  local_file_selected (ev) {\n    this.loading = true;\n    let reqs = [];\n    for (let i=0; i<ev.target.files.length; i++) {\n      // debugger\n      let file = ev.target.files[i];\n      let prom = this.GeoDataService.load_from_local_file(file).then( (retval) =>{return this._load_data_success(retval);});\n      reqs.push(prom);\n      // this.loading = false;\n    };\n    this.$q.all(reqs).then( ()=>{\n      this.loading = false;\n      //reset the picker\n      $('#file_picker').val('');\n    }).then( () => {\n      this.toastr.success('Imported file');\n    });\n  }\n\n  update_layer_style (prop) {\n    this.current_layer.setStyle({prop: this.current_layer.options[prop]});\n  }\n\n  save_locally () {\n    this.GeoDataService.save_locally(this.project);\n  }\n\n  save_to_depot () {\n    this.loading = true;\n    this.GeoDataService.save_to_depot(this.project).then( (resp) => {\n      this.loading = false;\n      this.toastr.success('Saved to data depot');\n    }, (err) => {\n      this.toastr.error('Save failed!');\n    });\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/controllers/map-sidebar.js","export default function customOnChange() {\n  return {\n    restrict: 'A',\n    scope: {\n      handler: '&'\n    },\n    link: function (scope, element, attrs) {\n      element.on('change', function (ev) {\n        scope.$apply(function(){\n          scope.handler({ev:ev});\n        });\n      });\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/directives/custom-on-change.js","import * as GeoUtils from '../utils/geo-utils';\nimport LayerGroup from '../models/layer_group';\nimport MapProject from '../models/map-project';\n\n\nexport default class GeoDataService {\n\n  constructor ($http, $q, UserService) {\n    'ngInject';\n    this.$http = $http;\n    this.$q = $q;\n    this.UserService = UserService;\n    this.active_project = null;\n    this.previous_project_state = null;\n  }\n\n  current_project(project) {\n    if (!(project)) {\n      return this.active_project;\n    }\n    this.active_project = project;\n  }\n\n  _resize_image (blob, max_width=400, max_height=400) {\n    return this.$q( (res, rej) => {\n      let base64 = this._arrayBufferToBase64(blob);\n      // Create and initialize two canvas\n      let canvas = document.createElement(\"canvas\");\n      let ctx = canvas.getContext(\"2d\");\n      let canvasCopy = document.createElement(\"canvas\");\n      let copyContext = canvasCopy.getContext(\"2d\");\n\n      // Create original image\n      let img = new Image();\n      img.src = base64;\n      img.onload = ()=>{\n        console.log(img.width);\n\n        // debugger\n        // Determine new ratio based on max size\n        let ratio = 1;\n        if(img.width > max_width) {\n          ratio = max_width / img.width;\n        } else if(img.height > max_height) {\n          ratio = max_height / img.height;\n        }\n        // Draw original image in second canvas\n        canvasCopy.width = img.width;\n        canvasCopy.height = img.height;\n        copyContext.drawImage(img, 0, 0);\n\n        // Copy and resize second canvas to first canvas\n        canvas.width = img.width * ratio;\n        canvas.height = img.height * ratio;\n        ctx.drawImage(canvasCopy, 0, 0, canvasCopy.width, canvasCopy.height, 0, 0, canvas.width, canvas.height);\n        res(canvas.toDataURL());\n      };\n    });\n  }\n\n  _arrayBufferToBase64( buffer ) {\n    let binary = '';\n    let bytes = new Uint8Array( buffer );\n    let len = bytes.byteLength;\n    for (let i = 0; i < len; i++) {\n        binary += String.fromCharCode( bytes[ i ] );\n    }\n    let encoded =  btoa( binary );\n    return 'data:image/jpg;base64,' + encoded;\n  }\n\n  _from_kml(text_blob) {\n    return this.$q( (res, rej) => {\n      let features = [];\n      let l = omnivore.kml.parse(text_blob);\n      l.getLayers().forEach((d) => {\n        console.log(d)\n        // d.feature.properties = {};\n        d.options.label = d.feature.properties.name;\n        features.push(d);\n      });\n      res(features);\n    });\n  }\n\n  _from_kmz (blob) {\n    return this.$q( (res, rej) => {\n      let zipper = new JSZip();\n      zipper.loadAsync(blob).then( (zip) => {\n        //loop over all the files in the archive\n        let proms = [];\n        for (let key in zip.files) {\n          console.log(key)\n          let ext = key.split('.').pop();\n          if (ext === 'kml') {\n            return zip.files[key].async('text');\n          }\n          if (ext === 'jpg') {\n            return zip.files[key].async('arraybuffer');\n          }\n        }\n      }).then( (txt) => {\n        let features = this._from_kml(txt);\n        res(features);\n      });\n    });\n  }\n\n  _from_json (blob) {\n    return this.$q( (res, rej) => {\n      if (blob.ds_map) return res(this._from_dsmap(blob));\n      let features = [];\n      L.geoJSON(blob).getLayers().forEach( (l) => {\n        console.log(l);\n        features.push(l);\n      });\n      res(features);\n    });\n  }\n\n  _from_gpx (blob) {\n    return this.$q( (res, rej) => {\n      // console.log(text_blob)\n      let features = [];\n      let l = omnivore.gpx.parse(blob);\n      l.getLayers().forEach((d) => {\n        features.push(d);\n      });\n      res(features);\n    });\n  }\n\n  _make_image_marker (lat, lon, thumb, preview) {\n    let icon = L.divIcon({\n      iconSize: [40, 40],\n      html: \"<div class='image' style='background:url(\" + thumb + \");background-size: 100% 100%'></div>\",\n      className: 'leaflet-marker-photo'\n    });\n\n    let marker = L.marker([lat, lon], {icon: icon})\n          .bindPopup(\"<img src=\" + preview + \">\",\n              {\n                className: 'leaflet-popup-photo',\n                maxWidth: \"auto\",\n                // maxHeight: 400\n              });\n    marker.options.image_src = preview;\n    marker.options.thumb_src = thumb;\n    return marker;\n  }\n\n  _from_image (file) {\n    return this.$q( (res, rej) => {\n      let exif = EXIF.readFromBinaryFile(file);\n      let encoded = this._arrayBufferToBase64(file);\n      let lat = exif.GPSLatitude;\n      let lon = exif.GPSLongitude;\n\n      //Convert coordinates to WGS84 decimal\n      let latRef = exif.GPSLatitudeRef || \"N\";\n      let lonRef = exif.GPSLongitudeRef || \"W\";\n      lat = (lat[0] + lat[1]/60 + lat[2]/3600) * (latRef == \"N\" ? 1 : -1);\n      lon = (lon[0] + lon[1]/60 + lon[2]/3600) * (lonRef == \"W\" ? -1 : 1);\n      let thumb = null;\n      let preview = null;\n      this._resize_image(file, 100, 100).then( (resp)=>{\n        thumb = resp;\n      }).then( ()=>{\n        return this._resize_image(file, 400, 400);\n      }).then( (resp)=>{\n        preview = resp;\n        let marker = this._make_image_marker(lat, lon, thumb, preview);\n        res([marker]);\n      });\n\n    });\n  }\n\n\n  _from_dsmap (json) {\n    return this.$q( (res, rej) => {\n      // if (json instanceof String) {\n      let project = new MapProject();\n      project.name = json.name;\n      project.description = json.description;\n      json.layer_groups.forEach( (name) => {\n        project.layer_groups.push(new LayerGroup(name, new L.FeatureGroup()));\n      });\n      json.features.forEach( (d)=> {\n        let feature = L.geoJSON(d);\n        feature.eachLayer( (layer)=> {\n          console.log(layer);\n          let layer_group_index = d.layer_group_index;\n          if ((layer instanceof L.Marker) && (layer.feature.properties.image_src)) {\n            let latlng = layer.getLatLng();\n            layer = this._make_image_marker(latlng.lat, latlng.lng, layer.feature.properties.thumb_src, layer.feature.properties.image_src);\n            // feat.options.image_src = feat.feature.properties.image_src;\n            // feat.options.thumb_src = feat.feature.properties.thumb_src;\n          }\n          project.layer_groups[layer_group_index].feature_group.addLayer(layer);\n          layer.options.label = d.properties.label;\n        });\n\n      });\n      res(project);\n    });\n  }\n\n  /*\n  This will return a promise that resolves to an array of features\n  that can be added to a LayerGroup\n  */\n  load_from_local_file (file) {\n    return this.$q( (res, rej) => {\n      let ext = GeoUtils.get_file_extension(file.name);\n      let reader = new FileReader();\n      //\n      if ((ext === 'kmz') || (ext === 'jpeg') || (ext === 'jpg')){\n        reader.readAsArrayBuffer(file);\n      } else {\n        reader.readAsText(file);\n      }\n      reader.onload = (e) => {\n        let p = null;\n        switch (ext) {\n          case 'kml':\n            p =  this._from_kml(e.target.result);\n            break;\n          case 'json':\n            p = this._from_json(JSON.parse(e.target.result));\n            break;\n          case 'geojson':\n            p = this._from_json(JSON.parse(e.target.result));\n            break;\n          case 'kmz':\n            p = this._from_kmz(e.target.result);\n            break;\n          case 'gpx':\n            p = this._from_gpx(e.target.result);\n            break;\n          case 'jpeg':\n            p = this._from_image(e.target.result);\n            break;\n          case 'jpg':\n            p = this._from_image(e.target.result);\n            break;\n          case 'dsmap':\n            p = this._from_dsmap(JSON.parse(e.target.result));\n            break;\n          default:\n            p = this._from_json(JSON.parse(e.target.result));\n        }\n        return res(p);\n      };\n    });\n  }\n\n  //\n  // @param f: a file from DataService\n  // returns a promise with the LayerGroup\n  load_from_data_depot(f) {\n    let ext = GeoUtils.get_file_extension(f.name);\n    let responseType = 'text';\n    if ((ext === 'kmz') || (ext === 'jpg') || (ext === 'jpeg')) {\n      responseType = 'arraybuffer';\n    }\n    return this.$http.get(f.agaveUrl(), {'responseType': responseType}).then((resp) => {\n      let p = null;\n      switch (ext) {\n        case 'kml':\n          p =  this._from_kml(resp.data);\n          break;\n        case 'json':\n          p = this._from_json(resp.data);\n          break;\n        case 'geojson':\n          p = this._from_json(resp.data);\n          break;\n        case 'kmz':\n          p = this._from_kmz(resp.data);\n          break;\n        case 'gpx':\n          p = this._from_gpx(resp.data);\n          break;\n        case 'jpeg':\n          p = this._from_image(resp.data);\n          break;\n        case 'jpg':\n          p = this._from_image(resp.data);\n          break;\n        case 'dsmap':\n          p = this._from_dsmap(resp.data);\n          break;\n        default:\n          p = this._from_json(resp.data);\n      }\n      return p;\n    });\n  }\n\n  save_locally (project) {\n    let gjson = project.to_json();\n    let blob = new Blob([JSON.stringify(gjson)], {type: \"application/json\"});\n    let url  = URL.createObjectURL(blob);\n\n    let a = document.createElement('a');\n    document.body.appendChild(a);\n    a.download    = project.name + \".geojson\";\n    a.href        = url;\n    a.textContent = \"Download\";\n    a.click();\n    document.body.removeChild(a);\n  }\n\n  save_to_depot (project) {\n    let gjson = project.to_json();\n    let blob = new Blob([JSON.stringify(gjson)], {type: \"application/json\"});\n    console.log(blob);\n    let base_file_url = 'https://agave.designsafe-ci.org/files/v2/media/system/designsafe.storage.default/' + this.UserService.currentUser().username;\n    let form = new FormData();\n    let file = new File([blob], project.name + '.dsmap');\n\n    form.append('fileToUpload', file, project.name + '.geojson');\n    return this.$http.post(base_file_url, form, {headers: {'Content-Type': undefined}});\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-data-service.js","export default class GeoStateService {\n\n  constructor ($scope, $state) {\n    this.$scope = $scope;\n    this.$state = $state;\n    this.last_db_path = null;\n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/services/geo-state-service.js","module.exports = L;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"L\"\n// module id = 12\n// module chunks = 0","import {mod as geo_directives} from './directives';\nimport {mod as geo_controllers} from './controllers';\nimport {mod as geo_services} from './services';\n\nlet mod = angular.module('designsafe');\nmod.requires.push('ui.router', 'ang-drag-drop', 'ds.geo.directives', 'ds.geo.controllers', 'ds.geo.services', 'toastr');\n\nfunction config($stateProvider, $uibTooltipProvider, $urlRouterProvider, $locationProvider) {\n  'ngInject';\n\n  $locationProvider.html5Mode({\n    enabled: false\n  });\n\n  $stateProvider.state('geo', {\n    url: '',\n    abstract: true,\n    templateUrl: '/static/designsafe/apps/geo/html/index.html',\n    resolve: {\n      auth: function () {\n        return true;\n      }\n    }\n  }).state('geo.map', {\n    url: '/map',\n    templateUrl: '/static/designsafe/apps/geo/html/map.html',\n    controller: 'MapSidebarCtrl as vm'\n  }).state('geo.help', {\n    url: '/help',\n    templateUrl: '/static/designsafe/apps/geo/html/help.html',\n    controller: 'HelpCtrl as vm'\n  });\n  $urlRouterProvider.when('/', '/#/map');\n\n  //config popups etc\n  $uibTooltipProvider.options({popupDelay:1000});\n\n}\n\nmod.config(config);\n\n\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./designsafe/apps/geo/static/designsafe/apps/geo/scripts/index.js"],"sourceRoot":""}